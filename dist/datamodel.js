!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define("DataModel",[],t):"object"==typeof exports?exports.DataModel=t():e.DataModel=t()}(window,(function(){return function(e){var t={};function n(r){if(t[r])return t[r].exports;var i=t[r]={i:r,l:!1,exports:{}};return e[r].call(i.exports,i,i.exports,n),i.l=!0,i.exports}return n.m=e,n.c=t,n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var i in e)n.d(r,i,function(t){return e[t]}.bind(null,i));return r},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=1)}([function(e){e.exports=JSON.parse('{"name":"datamodel","description":"Relational algebra compliant in-memory tabular data store","homepage":"https://github.com/chartshq/datamodel","version":"2.3.1","license":"MIT","main":"dist/datamodel.js","keywords":["datamodel","data","relational","algebra","model","muze","fusioncharts","table","tabular","operation"],"author":"Muzejs.org (https://muzejs.org/)","repository":{"type":"git","url":"https://github.com/chartshq/datamodel.git"},"contributors":[{"name":"Akash Goswami","email":"akashgoswami90s@gmail.com"},{"name":"Subhash Haldar"},{"name":"Rousan Ali","email":"rousanali786@gmail.com","url":"https://rousan.io"},{"name":"Ujjal Kumar Dutta","email":"duttaujjalkumar@live.com"},{"name":"Ranajit Banerjee","email":"ranajit.113124@gmail.com"},{"name":"Adarsh Lilha","email":"adarshlilha@gmail.com"},{"name":"Swati Mukherjee","email":"swati020494@gmail.com"}],"dependencies":{"d3-dsv":"^1.0.8"},"devDependencies":{"babel-cli":"6.26.0","babel-core":"^6.26.3","babel-eslint":"6.1.2","babel-loader":"^7.1.4","babel-plugin-transform-runtime":"^6.23.0","babel-preset-env":"^1.7.0","babel-preset-es2015":"^6.24.1","babel-preset-flow":"^6.23.0","chai":"3.5.0","cross-env":"^5.0.5","eslint":"3.19.0","eslint-config-airbnb":"15.1.0","eslint-plugin-import":"2.7.0","eslint-plugin-jsx-a11y":"5.1.1","eslint-plugin-react":"7.3.0","istanbul-instrumenter-loader":"^3.0.0","jsdoc":"3.5.5","json2yaml":"^1.1.0","karma":"1.7.1","karma-chai":"0.1.0","karma-chrome-launcher":"2.1.1","karma-coverage-istanbul-reporter":"^1.3.0","karma-mocha":"1.3.0","karma-spec-reporter":"0.0.31","karma-webpack":"2.0.3","marked":"^0.5.0","mocha":"3.4.2","mocha-webpack":"0.7.0","transform-runtime":"0.0.0","webpack":"^4.12.0","webpack-cli":"^3.0.7","webpack-dev-server":"^3.1.4"},"scripts":{"test":"npm run lint && npm run ut","ut":"karma start karma.conf.js","utd":"karma start --single-run false --browsers Chrome karma.conf.js ","build":"npm run build:prod","build:dev":"webpack --mode development","build:prod":"webpack --mode production","start":"webpack-dev-server --config webpack.config.dev.js --mode development --open","lint":"eslint ./src","lint-errors":"eslint --quiet ./src","docs":"rm -rf yaml && mkdir yaml && jsdoc -c jsdoc.conf.json"}}')},function(e,t,n){var r=n(2);e.exports=r.default?r.default:r},function(e,t,n){"use strict";n.r(t);var r={};n.r(r),n.d(r,"DataFormat",(function(){return o})),n.d(r,"DimensionSubtype",(function(){return u})),n.d(r,"MeasureSubtype",(function(){return c})),n.d(r,"FieldType",(function(){return f})),n.d(r,"FilteringMode",(function(){return l})),n.d(r,"GROUP_BY_FUNCTIONS",(function(){return s}));var i={};n.r(i),n.d(i,"Dimension",(function(){return Me})),n.d(i,"Measure",(function(){return Le})),n.d(i,"FieldParser",(function(){return Be})),n.d(i,"fieldRegistry",(function(){return Nt})),n.d(i,"columnMajor",(function(){return v}));var a={};n.r(a),n.d(a,"sum",(function(){return Zn})),n.d(a,"avg",(function(){return $n})),n.d(a,"min",(function(){return Qn})),n.d(a,"max",(function(){return er})),n.d(a,"first",(function(){return tr})),n.d(a,"last",(function(){return nr})),n.d(a,"count",(function(){return rr})),n.d(a,"sd",(function(){return ir}));var o={FLAT_JSON:"FlatJSON",DSV_STR:"DSVStr",DSV_ARR:"DSVArr",AUTO:"Auto"},u={CATEGORICAL:"categorical",TEMPORAL:"temporal",BINNED:"binned",ID:"__id"},c={CONTINUOUS:"continuous"},f={MEASURE:"measure",DIMENSION:"dimension"},l={NORMAL:"normal",INVERSE:"inverse",ALL:"all"},s={SUM:"sum",AVG:"avg",MIN:"min",MAX:"max",FIRST:"first",LAST:"last",COUNT:"count",STD:"std"};function p(e){return e instanceof Date?e:new Date(e)}function d(e){return e<10?"0"+e:e}function h(e){this.format=e,this.dtParams=void 0,this.nativeDate=void 0}RegExp.escape=function(e){return e.replace(/[-[\]{}()*+?.,\\^$|#\s]/g,"\\$&")},h.TOKEN_PREFIX="%",h.DATETIME_PARAM_SEQUENCE={YEAR:0,MONTH:1,DAY:2,HOUR:3,MINUTE:4,SECOND:5,MILLISECOND:6},h.defaultNumberParser=function(e){return function(t){var n;return isFinite(n=parseInt(t,10))?n:e}},h.defaultRangeParser=function(e,t){return function(n){var r,i=void 0;if(!n)return t;var a=n.toLowerCase();for(i=0,r=e.length;i<r;i++)if(e[i].toLowerCase()===a)return i;return void 0===i?t:null}},h.getTokenDefinitions=function(){var e={short:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],long:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"]},t={short:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],long:["January","February","March","April","May","June","July","August","September","October","November","December"]};return{H:{name:"H",index:3,extract:function(){return"(\\d+)"},parser:h.defaultNumberParser(),formatter:function(e){return p(e).getHours().toString()}},l:{name:"l",index:3,extract:function(){return"(\\d+)"},parser:h.defaultNumberParser(),formatter:function(e){var t=p(e).getHours()%12;return(0===t?12:t).toString()}},p:{name:"p",index:3,extract:function(){return"(AM|PM)"},parser:function(e){return e?e.toLowerCase():null},formatter:function(e){return p(e).getHours()<12?"AM":"PM"}},P:{name:"P",index:3,extract:function(){return"(am|pm)"},parser:function(e){return e?e.toLowerCase():null},formatter:function(e){return p(e).getHours()<12?"am":"pm"}},M:{name:"M",index:4,extract:function(){return"(\\d+)"},parser:h.defaultNumberParser(),formatter:function(e){return d(p(e).getMinutes())}},S:{name:"S",index:5,extract:function(){return"(\\d+)"},parser:h.defaultNumberParser(),formatter:function(e){return d(p(e).getSeconds())}},K:{name:"K",index:6,extract:function(){return"(\\d+)"},parser:h.defaultNumberParser(),formatter:function(e){return p(e).getMilliseconds().toString()}},a:{name:"a",index:2,extract:function(){return"("+e.short.join("|")+")"},parser:h.defaultRangeParser(e.short),formatter:function(t){var n=p(t).getDay();return e.short[n].toString()}},A:{name:"A",index:2,extract:function(){return"("+e.long.join("|")+")"},parser:h.defaultRangeParser(e.long),formatter:function(t){var n=p(t).getDay();return e.long[n].toString()}},e:{name:"e",index:2,extract:function(){return"(\\d+)"},parser:h.defaultNumberParser(),formatter:function(e){return p(e).getDate().toString()}},d:{name:"d",index:2,extract:function(){return"(\\d+)"},parser:h.defaultNumberParser(),formatter:function(e){return d(p(e).getDate())}},b:{name:"b",index:1,extract:function(){return"("+t.short.join("|")+")"},parser:h.defaultRangeParser(t.short),formatter:function(e){var n=p(e).getMonth();return t.short[n].toString()}},B:{name:"B",index:1,extract:function(){return"("+t.long.join("|")+")"},parser:h.defaultRangeParser(t.long),formatter:function(e){var n=p(e).getMonth();return t.long[n].toString()}},m:{name:"m",index:1,extract:function(){return"(\\d+)"},parser:function(e){return h.defaultNumberParser()(e)-1},formatter:function(e){return d(p(e).getMonth()+1)}},y:{name:"y",index:0,extract:function(){return"(\\d{2})"},parser:function(e){var t=void 0;if(e){var n=e.length;e=e.substring(n-2,n)}var r=h.defaultNumberParser()(e),i=new Date,a=Math.trunc(i.getFullYear()/100);return p(t=""+a+r).getFullYear()>i.getFullYear()&&(t=""+(a-1)+r),p(t).getFullYear()},formatter:function(e){var t=p(e).getFullYear().toString(),n=void 0;return t&&(n=t.length,t=t.substring(n-2,n)),t}},Y:{name:"Y",index:0,extract:function(){return"(\\d{4})"},parser:h.defaultNumberParser(),formatter:function(e){return p(e).getFullYear().toString()}}}},h.getTokenFormalNames=function(){var e=h.getTokenDefinitions();return{HOUR:e.H,HOUR_12:e.l,AMPM_UPPERCASE:e.p,AMPM_LOWERCASE:e.P,MINUTE:e.M,SECOND:e.S,SHORT_DAY:e.a,LONG_DAY:e.A,DAY_OF_MONTH:e.e,DAY_OF_MONTH_CONSTANT_WIDTH:e.d,SHORT_MONTH:e.b,LONG_MONTH:e.B,MONTH_OF_YEAR:e.m,SHORT_YEAR:e.y,LONG_YEAR:e.Y}},h.tokenResolver=function(){var e=h.getTokenDefinitions(),t=function(){for(var e=0,t=void 0,n=void 0,r=arguments.length;e<r;e++)t=arguments.length<=e?void 0:arguments[e],(arguments.length<=e?void 0:arguments[e])&&(n=t);return n?n[0].parser(n[1]):null};return{YEAR:[e.y,e.Y,t],MONTH:[e.b,e.B,e.m,t],DAY:[e.a,e.A,e.e,e.d,t],HOUR:[e.H,e.l,e.p,e.P,function(e,t,n,r){var i=void 0,a=void 0,o=void 0,u=void 0;return t&&(a=n||r)?("pm"===a[0].parser(a[1])&&(o=!0),i=t):i=t||e,i?(u=i[0].parser(i[1]),o&&(u+=12),u):null}],MINUTE:[e.M,t],SECOND:[e.S,t]}},h.findTokens=function(e){for(var t=h.TOKEN_PREFIX,n=h.getTokenDefinitions(),r=Object.keys(n),i=[],a=void 0,o=void 0;(a=e.indexOf(t,a+1))>=0;)o=e[a+1],-1!==r.indexOf(o)&&i.push({index:a,token:o});return i},h.formatAs=function(e,t){var n,r=p(e),i=h.findTokens(t),a=h.getTokenDefinitions(),o=String(t),u=h.TOKEN_PREFIX,c=void 0,f=void 0,l=void 0;for(l=0,n=i.length;l<n;l++)f=a[c=i[l].token].formatter(r),o=o.replace(new RegExp(u+c,"g"),f);return o},h.prototype.parse=function(e,t){var n=h.tokenResolver(),r=this.extractTokenValue(e),i=h.DATETIME_PARAM_SEQUENCE,a=t&&t.noBreak,o=[],u=[],c=void 0,f=void 0,l=void 0,s=void 0,p=void 0,d=void 0,v=void 0,y=void 0,m=[];for(c in n)if({}.hasOwnProperty.call(n,c)){for(u.length=0,l=(f=n[c]).splice(f.length-1,1)[0],p=0,y=f.length;p<y;p++)void 0===(s=r[(d=f[p]).name])?u.push(null):u.push([d,s]);if(null==(v=l.apply(this,u))&&!a)break;o[i[c]]=v}return o.length&&this.checkIfOnlyYear(o.length)?m.unshift(o[0],0,1):m.unshift.apply(m,o),m},h.prototype.extractTokenValue=function(e){var t,n=this.format,r=h.getTokenDefinitions(),i=h.TOKEN_PREFIX,a=h.findTokens(n),o={},u=void 0,c=void 0,f=void 0,l=void 0,s=void 0,p=void 0;s=String(n);var d=a.map((function(e){return e.token})),v=a.length;for(p=v-1;p>=0;p--)(f=a[p].index)+1!==s.length-1?(void 0===u&&(u=s.length),l=s.substring(f+2,u),s=s.substring(0,f+2)+RegExp.escape(l)+s.substring(u,s.length),u=f):u=f;for(p=0;p<v;p++)c=a[p],s=s.replace(i+c.token,r[c.token].extract());var y=e.match(new RegExp(s))||[];for(y.shift(),p=0,t=d.length;p<t;p++)o[d[p]]=y[p];return o},h.prototype.getNativeDate=function(e){var t=null;if(Number.isFinite(e))t=new Date(e);else if(!this.format&&Date.parse(e))t=new Date(e);else{var n=this.dtParams=this.parse(e);n.length&&(this.nativeDate=new(Function.prototype.bind.apply(Date,[null].concat(function(e){if(Array.isArray(e)){for(var t=0,n=Array(e.length);t<e.length;t++)n[t]=e[t];return n}return Array.from(e)}(n)))),t=this.nativeDate)}return t},h.prototype.checkIfOnlyYear=function(e){return 1===e&&this.format.match(/y|Y/g).length},h.prototype.formatAs=function(e,t){var n=void 0;return t?n=this.nativeDate=this.getNativeDate(t):(n=this.nativeDate)||(n=this.getNativeDate(t)),h.formatAs(n,e)};var v=function(e){var t=0;return function(){for(var n=arguments.length,r=Array(n),i=0;i<n;i++)r[i]=arguments[i];r.forEach((function(n,r){e[r]instanceof Array||(e[r]=Array.from({length:t})),e[r].push(n)})),t++}},y="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},m=Object.prototype.toString;function b(e,t){for(var n=t.length,r=-1;n;){if(e===t[n])return r=n;n-=1}return r}function g(e,t,n){return"object"!==(void 0===e?"undefined":y(e))&&"object"!==(void 0===t?"undefined":y(t))?null:"object"!==(void 0===t?"undefined":y(t))||null===t?e:("object"!==(void 0===e?"undefined":y(e))&&(e=t instanceof Array?[]:{}),function e(t,n,r,i,a){var o,u,c,f,l;if(a?(i.push(t),a.push(n)):(i=[t],a=[n]),n instanceof Array)for(o=0;o<n.length;o+=1){try{u=t[o],c=n[o]}catch(e){continue}"object"!==(void 0===c?"undefined":y(c))?r&&void 0===c||(t[o]=c):(null!==u&&"object"===(void 0===u?"undefined":y(u))||(u=t[o]=c instanceof Array?[]:{}),-1!==(l=b(c,a))?u=t[o]=i[l]:e(u,c,r,i,a))}else for(o in n){try{u=t[o],c=n[o]}catch(e){continue}if(null!==c&&"object"===(void 0===c?"undefined":y(c)))"[object Object]"===(f=m.call(c))?(null!==u&&"object"===(void 0===u?"undefined":y(u))||(u=t[o]={}),-1!==(l=b(c,a))?u=t[o]=i[l]:e(u,c,r,i,a)):"[object Array]"===f?(null!==u&&u instanceof Array||(u=t[o]=[]),-1!==(l=b(c,a))?u=t[o]=i[l]:e(u,c,r,i,a)):t[o]=c;else{if(r&&void 0===c)continue;t[o]=c}}return t}(e,t,n),e)}function _(e){return Array.isArray(e)}var w=function(){return"id-"+(new Date).getTime()+Math.round(1e4*Math.random())};function O(e,t){if(!_(e)||!_(t))return e===t;if(e.length!==t.length)return!1;for(var n=0;n<e.length;n++)if(e[n]!==t[n])return!1;return!0}function E(e){return e}var j=function(e){return"string"==typeof e?o.DSV_STR:_(e)&&_(e[0])?o.DSV_ARR:_(e)&&(0===e.length||function(e){return e===Object(e)}(e[0]))?o.FLAT_JSON:null},A={data:{},createNamespace:function(e,t,n){var r=t||w();return this.data[r]={name:r,fields:e,idField:n,fieldsObj:function(){var e=this._cachedFieldsObj;return e||(e=this._cachedFieldsObj={},this.fields.forEach((function(t){e[t.name()]=t}))),e},getMeasure:function(){var e=this._cachedMeasure;return e||(e=this._cachedMeasure={},this.fields.forEach((function(t){t.schema().type===f.MEASURE&&(e[t.name()]=t)}))),e},getDimension:function(){var e=this._cachedDimension;return this._cachedDimension||(e=this._cachedDimension={},this.fields.forEach((function(t){t.schema().type===f.DIMENSION&&(e[t.name()]=t)}))),e}},this.data[r]}},k=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();var D=function(){function e(t,n,r){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e);var i=Bn(r,t);Object.defineProperties(this,{_value:{enumerable:!1,configurable:!1,writable:!1,value:t},_formattedValue:{enumerable:!1,configurable:!1,writable:!1,value:i},_internalValue:{enumerable:!1,configurable:!1,writable:!1,value:n}}),this.field=r}return k(e,[{key:"toString",value:function(){return String(this.value)}},{key:"valueOf",value:function(){return this.value}},{key:"value",get:function(){return this._value}},{key:"formattedValue",get:function(){return this._formattedValue}},{key:"internalValue",get:function(){return this._internalValue}}]),e}();function S(e,t){e.length>0&&e.split(",").forEach((function(e){var n=e.split("-"),r=+n[0],i=+(n[1]||n[0]);if(i>=r)for(var a=r;a<=i;a+=1)t(a)}))}var F=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();var N=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._value=t}return F(e,null,[{key:"invalidAwareVals",value:function(t){return t?Object.assign(e._invalidAwareValsMap,t):e._invalidAwareValsMap}}]),F(e,[{key:"value",value:function(){return this._value}},{key:"toString",value:function(){return String(this._value)}}],[{key:"isInvalid",value:function(t){return t instanceof e||!!e.invalidAwareVals()[t]}},{key:"getInvalidType",value:function(t){return t instanceof e?t:e.invalidAwareVals()[t]}}]),e}();N.NULL=new N("null"),N.NA=new N("na"),N.NIL=new N("nil"),N._invalidAwareValsMap={invalid:N.NA,nil:N.NIL,null:N.NULL,undefined:N.NA};var T=N,P=function(e,t){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return function(e,t){var n=[],r=!0,i=!1,a=void 0;try{for(var o,u=e[Symbol.iterator]();!(r=(o=u.next()).done)&&(n.push(o.value),!t||n.length!==t);r=!0);}catch(e){i=!0,a=e}finally{try{!r&&u.return&&u.return()}finally{if(i)throw a}}return n}(e,t);throw new TypeError("Invalid attempt to destructure non-iterable instance")};function I(e,t,n){var r=n.buckets,i=n.binsCount,a=n.binSize,o=n.start,u=n.end,c=e.domain(),f=P(c,2),l=f[0],s=f[1];r||(o=0!==o&&(!o||o>l)?l:o,u=0!==u&&(!u||u<s)?s+1:u,i&&(a=Math.ceil(Math.abs(u-o)/i)),r=function(e,t,n){for(var r=[],i=t;i<n;)r.push(i),i+=e;return r.push(i),r}(a,o,u)),r[0]>l&&r.unshift(l),r[r.length-1]<=s&&r.push(s+1);for(var p=[],d=0;d<r.length-1;d++)p.push({start:r[d],end:r[d+1]});var h=[];return S(t,(function(t){var n=e.partialField.data[t];if(n instanceof T)h.push(n);else{var r=function(e,t){for(var n=0,r=e.length-1,i=void 0,a=void 0;n<=r;){if(t>=(a=e[i=n+Math.floor((r-n)/2)]).start&&t<a.end)return a;t>=a.end?n=i+1:t<a.start&&(r=i-1)}return null}(p,n);h.push(r.start+"-"+r.end)}})),{binnedData:h,bins:r}}var C="__id__",M={SELECT:"select",PROJECT:"project",GROUPBY:"group",COMPOSE:"compose",CAL_VAR:"calculatedVariable",BIN:"bin",SORT:"sort"},R="cross",x="leftOuter",U="rightOuter",L="and";function V(e){if(Array.isArray(e)){for(var t=0,n=Array(e.length);t<e.length;t++)n[t]=e[t];return n}return Array.from(e)}function B(e,t){var n=[],r=[];return e.fields.forEach((function(e){r.push(e.schema().name)})),t.fields.forEach((function(e){-1!==r.indexOf(e.schema().name)&&n.push(e.schema().name)})),n}function Y(){return!0}function H(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]&&arguments[3],i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:R,a=[],o=[],u=n||Y,c=e.getFieldspace(),f=t.getFieldspace(),l=c.name,s=f.name,p=c.name+"."+f.name,d=B(c,f);if(l===s)throw new Error("DataModels must have different alias names");return c.fields.forEach((function(e){var t=g({},e.schema());-1===d.indexOf(t.name)||r||(t.name=c.name+"."+t.name),a.push(t)})),f.fields.forEach((function(e){var t=g({},e.schema());-1!==d.indexOf(t.name)?r||(t.name=f.name+"."+t.name,a.push(t)):a.push(t)})),S(e._rowDiffset,(function(n){var p=!1,h=void 0;S(t._rowDiffset,(function(v){var y=[],m={};m[l]={},m[s]={},c.fields.forEach((function(e){y.push(e.partialField.data[n]),m[l][e.name()]={rawValue:e.partialField.data[n],formattedValue:e.formattedData()[n]}})),f.fields.forEach((function(e){-1!==d.indexOf(e.schema().name)&&r||y.push(e.partialField.data[v]),m[s][e.name()]={rawValue:e.partialField.data[v],formattedValue:e.formattedData()[v]}}));var b=fn(m[l]),g=fn(m[s]);if(u(b,g,(function(){return e.detachedRoot()}),(function(){return t.detachedRoot()}),{})){var _={};y.forEach((function(e,t){_[a[t].name]=e})),p&&R!==i?o[h]=_:(o.push(_),p=!0,h=n)}else if((i===x||i===U)&&!p){var w={},O=c.fields.length-1;y.forEach((function(e,t){w[a[t].name]=t<=O?e:null})),p=!0,h=n,o.push(w)}}))})),new qn(o,a,{name:p})}function J(e,t){var n=""+e,r=""+t;return n<r?-1:n>r?1:0}function G(e,t,n,r){if(n===t)return e;var i=t+Math.floor((n-t)/2);return G(e,t,i,r),G(e,i+1,n,r),function(e,t,n,r,i){for(var a=e,o=[],u=t;u<=r;u+=1)o[u]=a[u];for(var c=t,f=n+1,l=t;l<=r;l+=1)c>n?(a[l]=o[f],f+=1):f>r?(a[l]=o[c],c+=1):i(o[c],o[f])<=0?(a[l]=o[c],c+=1):(a[l]=o[f],f+=1)}(e,t,i,n,r),e}function z(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:J;return e.length>1&&G(e,0,e.length-1,t),e}var K=function(e,t){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return function(e,t){var n=[],r=!0,i=!1,a=void 0;try{for(var o,u=e[Symbol.iterator]();!(r=(o=u.next()).done)&&(n.push(o.value),!t||n.length!==t);r=!0);}catch(e){i=!0,a=e}finally{try{!r&&u.return&&u.return()}finally{if(i)throw a}}return n}(e,t);throw new TypeError("Invalid attempt to destructure non-iterable instance")};function W(e){if(Array.isArray(e)){for(var t=0,n=Array(e.length);t<e.length;t++)n[t]=e[t];return n}return Array.from(e)}function X(e,t){var n="desc"===String(t).toLowerCase()?"desc":"asc";return function(e,t){var n=void 0;switch(e){case c.CONTINUOUS:case u.TEMPORAL:n="asc"===t?function(e,t){return e-t}:function(e,t){return t-e};break;default:n="asc"===t?function(e,t){return(e=""+e)===(t=""+t)?0:e>t?1:-1}:function(e,t){return(e=""+e)===(t=""+t)?0:e>t?-1:1}}return n}(e.type,n)}function q(e,t){var n=new Map,r=[];return e.forEach((function(e){var i=e[t];n.has(i)?r[n.get(i)][1].push(e):(r.push([i,[e]]),n.set(i,r.length-1))})),r}function Z(e,t,n){var r={label:e[0]};return t.reduce((function(t,r,i){return t[r]=e[1].map((function(e){return e[n[i].index]})),t}),r),r}function $(e,t,n){for(var r=void 0,i=void 0,a=void 0,o=n.length-1;o>=0;o--)r=n[o][0],i=n[o][1],(a=Pn(t,r))&&("function"==typeof i?z(e,(function(e,t){return i(e[a.index],t[a.index])})):_(i)?function(){var n=q(e,a.index),r=i[i.length-1],o=i.slice(0,i.length-1),u=o.map((function(e){return Pn(t,e)}));n.forEach((function(e){e.push(Z(e,o,u))})),z(n,(function(e,t){var n=e[2],i=t[2];return r(n,i)})),e.length=0,n.forEach((function(t){e.push.apply(e,W(t[1]))}))}():function(){var t=X(a,i);z(e,(function(e,n){return t(e[a.index],n[a.index])}))}())}var Q;function ee(e,t,n,r){if(0===(n=n.filter((function(e){return null!==e[1]||(r.push(e[0]),!1)}))).length)return e;var i=function e(t,n,r,i){if(0===t.length)return n;var a=t[0],o=new Map;n.reduce((function(e,t){var n=t[a.index];return e.has(n)?e.get(n).push(t):e.set(n,[t]),e}),o);var u=!0,c=!1,f=void 0;try{for(var l,s=o[Symbol.iterator]();!(u=(l=s.next()).done);u=!0){var p=l.value,d=K(p,2),h=d[0],v=d[1],y=e(t.slice(1),v,r,i);o.set(h,y),Array.isArray(y)&&$(y,r,i)}}catch(e){c=!0,f=e}finally{try{!u&&s.return&&s.return()}finally{if(c)throw f}}return o}(r=r.map((function(e){return Pn(t,e)})),e,t,n);return e.map((function(e){for(var t=0,n=i;!Array.isArray(n);)n=n.get(e[r[t++].index]);return n.shift()}))}function te(e,t,n,r,i){var a=e.fields,o=e.idField.data();i=Object.assign({},{addUid:!1,columnWise:!1},i);var c={schema:[],data:[],uids:[]},l=i.addUid,s=r&&r.length>0,p=[];if(n.split(",").forEach((function(e){for(var t=0;t<a.length;t+=1){if(a[t].name()===e){p.push(a[t]);break}}})),p.forEach((function(e){c.schema.push(e.schema())})),l&&c.schema.push({name:C,type:f.DIMENSION,subtype:u.ID}),S(t,(function(e){c.data.push([]);var t=c.data.length-1;p.forEach((function(n,r){c.data[t][r+0]=n.partialField.data[e]})),l&&(c.data[t][p.length]=o[e]),c.uids.push(o[e]),s&&c.data[t].push(o[e])})),s&&function(e,t){var n=e.schema,r=e.data;if(0!==(t=t.filter((function(e){return!!Pn(n,e[0])}))).length){var i=t.findIndex((function(e){return null===e[1]}));i=-1!==i?i:t.length;var a=t.slice(0,i),o=t.slice(i);$(r,n,a),r=ee(r,n,o,a.map((function(e){return e[0]}))),e.uids=r.map((function(e){return e.pop()})),e.data=r}}(c,r),i.columnWise){var d=Array.apply(void 0,function(e){if(Array.isArray(e)){for(var t=0,n=Array(e.length);t<e.length;t++)n[t]=e[t];return n}return Array.from(e)}(Array(c.schema.length))).map((function(){return[]}));c.data.forEach((function(e){e.forEach((function(e,t){d[t].push(e)}))})),c.data=d}return c}function ne(e,t){var n={},r=[],i=[],a=[],o=e.getFieldspace(),u=t.getFieldspace(),c=o.fieldsObj(),f=u.fieldsObj(),l=o.name+" union "+u.name;if(!O(e._colIdentifier.split(",").sort(),t._colIdentifier.split(",").sort()))return null;function s(e,t,r){S(e._rowDiffset,(function(e){var o={},u="";i.forEach((function(n){var r=t[n].partialField.data[e];u+="-"+r,o[n]=r})),n[u]||(r&&a.push(o),n[u]=!0)}))}return e._colIdentifier.split(",").forEach((function(e){var t=c[e];r.push(g({},t.schema())),i.push(t.schema().name)})),s(t,f,!1),s(e,c,!0),new qn(a,r,{name:l})}function re(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function ie(e){if(Array.isArray(e)){for(var t=0,n=Array(e.length);t<e.length;t++)n[t]=e[t];return n}return Array.from(e)}var ae=s.SUM,oe=s.AVG,ue=s.FIRST,ce=s.LAST,fe=s.COUNT,le=s.STD,se=s.MIN,pe=s.MAX;function de(e){return e.filter((function(e){return!(e instanceof T)}))}function he(e){if(_(e)&&!(e[0]instanceof Array)){var t=de(e);return t.length?t.reduce((function(e,t){return e+t}),0):T.NULL}return T.NULL}function ve(e){if(_(e)&&!(e[0]instanceof Array)){var t=he(e),n=e.length||1;return Number.isNaN(t)||t instanceof T?T.NULL:t/n}return T.NULL}var ye=(re(Q={},ae,he),re(Q,oe,ve),re(Q,se,(function(e){if(_(e)&&!(e[0]instanceof Array)){var t=de(e);return t.length?Math.min.apply(Math,ie(t)):T.NULL}return T.NULL})),re(Q,pe,(function(e){if(_(e)&&!(e[0]instanceof Array)){var t=de(e);return t.length?Math.max.apply(Math,ie(t)):T.NULL}return T.NULL})),re(Q,ue,(function(e){return e[0]})),re(Q,ce,(function(e){return e[e.length-1]})),re(Q,fe,(function(e){return _(e)?e.length:T.NULL})),re(Q,le,(function(e){return Math.sqrt(function(e){var t=ve(e);return ve(e.map((function(e){return Math.pow(e-t,2)})))}(e))})),Q),me=ae,be=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();var ge,_e=function(){function e(){var t=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.store=new Map,this.store.set("defReducer",he),Object.entries(ye).forEach((function(e){t.store.set(e[0],e[1])}))}return be(e,[{key:"defaultReducer",value:function(){if(!arguments.length)return this.store.get("defReducer");var e=arguments.length<=0?void 0:arguments[0];if("function"==typeof e)this.store.set("defReducer",e);else{if(e=String(e),-1===Object.keys(ye).indexOf(e))throw new Error("Reducer "+e+" not found in registry");this.store.set("defReducer",ye[e])}return this}},{key:"register",value:function(e,t){var n=this;if("function"!=typeof t)throw new Error("Reducer should be a function");return e=String(e),this.store.set(e,t),function(){n.__unregister(e)}}},{key:"__unregister",value:function(e){this.store.has(e)&&this.store.delete(e)}},{key:"resolve",value:function(e){return e instanceof Function?e:this.store.get(e)}}]),e}(),we=(null===(ge=null)&&(ge=new _e),ge),Oe=function(e,t){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return function(e,t){var n=[],r=!0,i=!1,a=void 0;try{for(var o,u=e[Symbol.iterator]();!(r=(o=u.next()).done)&&(n.push(o.value),!t||n.length!==t);r=!0);}catch(e){i=!0,a=e}finally{try{!r&&u.return&&u.return()}finally{if(i)throw a}}return n}(e,t);throw new TypeError("Invalid attempt to destructure non-iterable instance")};function Ee(e,t,n){var r=function(e,t){var n=[],r=e.getFieldspace().getDimension();return Object.entries(r).forEach((function(e){var r=Oe(e,1)[0];t&&t.length?-1!==t.indexOf(r)&&n.push(r):n.push(r)})),n}(e,t),i=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n={},r=e.getFieldspace(),i=r.getMeasure(),a=we.defaultReducer();return Object.keys(i).forEach((function(e){"string"!=typeof t[e]&&(t[e]=i[e].defAggFn());var r=we.resolve(t[e]);r?n[e]=r:(n[e]=a,t[e]=me)})),n}(e,n),a=e.getFieldspace(),o=e.getPartialFieldspace().idField.data(),c=a.fieldsObj(),l=a.name,s=[],p=[],d=[],h={},v=[];Object.entries(c).forEach((function(e){var t=Oe(e,2),n=t[0],a=t[1];if(-1!==r.indexOf(n)||i[n])switch(d.push(g({},a.schema())),a.schema().type){case f.MEASURE:p.push(n);break;default:case f.DIMENSION:s.push(n)}}));var y=0,m=[];S(e._rowDiffset,(function(e){var t="";s.forEach((function(n){t=t+"-"+c[n].partialField.data[e]})),void 0===h[t]?(h[t]=y,v.push({}),m.push([]),s.forEach((function(t){v[y][t]=c[t].partialField.data[e]})),p.forEach((function(t){v[y][t]=[c[t].partialField.data[e]]})),m[y]=[""+o[e]],y+=1):(p.forEach((function(n){v[h[t]][n].push(c[n].partialField.data[e])})),m[h[t]].push(""+o[e]))}));var b={},_=function(){return e.detachedRoot()};return v.forEach((function(e,t){var n=e;p.forEach((function(t){n[t]=i[t](e[t],_,b)})),n.__id__=m[t]})),d.push({name:C,type:f.DIMENSION,subtype:u.ID}),new ur(v,d,{name:l})}function je(e,t){var n=B(e.getFieldspace(),t.getFieldspace());return function(e,t){var r=!0;return n.forEach((function(n){r=!(e[n].internalValue!==t[n].internalValue||!r)})),r}}function Ae(e,t){var n={},r=[],i=[],a=[],o=e.getFieldspace(),u=t.getFieldspace(),c=o.fieldsObj(),f=u.fieldsObj(),l=o.name+" union "+u.name;if(!O(e._colIdentifier.split(",").sort(),t._colIdentifier.split(",").sort()))return null;function s(e,t){S(e._rowDiffset,(function(e){var r={},o="";i.forEach((function(n){var i=t[n].partialField.data[e];o+="-"+i,r[n]=i})),n[o]||(a.push(r),n[o]=!0)}))}return e._colIdentifier.split(",").forEach((function(e){var t=c[e];r.push(g({},t.schema())),i.push(t.schema().name)})),s(e,c),s(t,f),new ur(a,r,{name:l})}function ke(e,t,n){return H(e,t,n,!1,x)}function De(e,t,n){return H(t,e,n,!1,U)}var Se=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();var Fe=function(){function e(t,n,r,i){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.name=t,this.schema=r,this.parser=i,this.data=this._sanitize(n)}return Se(e,[{key:"_sanitize",value:function(e){var t=this;return e.map((function(e){return t.parser.parse(e,{format:t.schema.format})}))}}]),e}(),Ne=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();var Te=function(){function e(t,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.partialField=t,this.rowDiffset=n}return Ne(e,[{key:"domain",value:function(){throw new Error("Not yet implemented")}},{key:"schema",value:function(){return this.partialField.schema}},{key:"name",value:function(){return this.partialField.name}},{key:"type",value:function(){return this.partialField.schema.type}},{key:"subtype",value:function(){return this.partialField.schema.subtype}},{key:"description",value:function(){return this.partialField.schema.description}},{key:"displayName",value:function(){return this.partialField.schema.displayName||this.partialField.schema.name}},{key:"data",value:function(){var e=this,t=[];return S(this.rowDiffset,(function(n){t.push(e.partialField.data[n])})),t}},{key:"formattedData",value:function(){throw new Error("Not yet implemented")}}],[{key:"parser",value:function(){throw new Error("Not yet implemented")}},{key:"BUILDER",get:function(){return{_params:{},_context:this,fieldName:function(e){return this._params.name=e,this},schema:function(e){return this._params.schema=e,this},data:function(e){return this._params.data=e,this},partialField:function(e){return this._params.partialField=e,this},rowDiffset:function(e){return this._params.rowDiffset=e,this},build:function(){var e=null;if(this._params.partialField instanceof Fe)e=this._params.partialField;else{if(!this._params.schema||!this._params.data)throw new Error("Invalid Field parameters");e=new Fe(this._params.name,this._params.data,this._params.schema,this._context.parser())}return new this._context(e,this._params.rowDiffset)}}}}]),e}(),Pe=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();function Ie(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function Ce(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}var Me=function(e){function t(){return Ie(this,t),Ce(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),Pe(t,[{key:"domain",value:function(){return this._cachedDomain||(this._cachedDomain=this.calculateDataDomain()),this._cachedDomain}},{key:"calculateDataDomain",value:function(){throw new Error("Not yet implemented")}},{key:"formattedData",value:function(){return this.data()}}]),t}(Te),Re=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();function xe(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function Ue(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}var Le=function(e){function t(){return xe(this,t),Ue(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),Re(t,[{key:"domain",value:function(){return this._cachedDomain||(this._cachedDomain=this.calculateDataDomain()),this._cachedDomain}},{key:"unit",value:function(){return this.partialField.schema.unit}},{key:"defAggFn",value:function(){return this.partialField.schema.defAggFn||me}},{key:"numberFormat",value:function(){var e=this.partialField.schema.numberFormat;return e instanceof Function?e:E}},{key:"calculateDataDomain",value:function(){throw new Error("Not yet implemented")}},{key:"formattedData",value:function(){return this.data()}}]),t}(Te),Ve=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();var Be=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}return Ve(e,[{key:"parse",value:function(){throw new Error("Not yet implemented")}}]),e}(),Ye=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();function He(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function Je(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}var Ge=function(e){function t(){return He(this,t),Je(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),Ye(t,[{key:"parse",value:function(e){return T.isInvalid(e)?T.getInvalidType(e):String(e).trim()}}]),t}(Be),ze=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();function Ke(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function We(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}var Xe=function(e){function t(){return Ke(this,t),We(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),ze(t,[{key:"subtype",value:function(){return u.CATEGORICAL}},{key:"calculateDataDomain",value:function(){var e=this,t=new Set,n=[];return S(this.rowDiffset,(function(r){var i=e.partialField.data[r];t.has(i)||(t.add(i),n.push(i))})),n}}],[{key:"parser",value:function(){return new Ge}}]),t}(Me),qe=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();function Ze(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function $e(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}var Qe=function(e){function t(){return Ze(this,t),$e(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),qe(t,[{key:"parse",value:function(e,t){var n=t.format,r=void 0;if(this._dtf||(this._dtf=new h(n)),T.isInvalid(e))r=T.getInvalidType(e);else{var i=this._dtf.getNativeDate(e);r=i?i.getTime():T.NA}return r}}]),t}(Be),et=function(e,t){var n=Number.POSITIVE_INFINITY,r=Number.NEGATIVE_INFINITY;return S(t,(function(t){var i=e[t];i instanceof T||(i<n&&(n=i),i>r&&(r=i))})),[n,r]},tt=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();var nt=function(e){function t(e,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var r=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,n));return r._cachedMinDiff=null,r}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),tt(t,[{key:"calculateDataDomain",value:function(){return et(this.partialField.data,this.rowDiffset)}},{key:"minimumConsecutiveDifference",value:function(){if(this._cachedMinDiff)return this._cachedMinDiff;for(var e=this.data().filter((function(e){return!(e instanceof T)})).sort((function(e,t){return e-t})),t=e.length,n=Number.POSITIVE_INFINITY,r=void 0,i=void 0,a=0,o=1;o<t;o++)r=e[o-1],(i=e[o])!==r&&(n=Math.min(n,i-e[o-1]),a++);return a||(n=null),this._cachedMinDiff=n,this._cachedMinDiff}},{key:"format",value:function(){return this.partialField.schema.format}},{key:"formattedData",value:function(){var e=this,t=[],n=this.format();return S(this.rowDiffset,(function(r){var i=e.partialField.data[r];if(T.isInvalid(i)||!n&&Number.isFinite(i)){var a=T.getInvalidType(i)||i;t.push(a)}else t.push(h.formatAs(i,n))})),t}}],[{key:"parser",value:function(){return new Qe}}]),t}(Me),rt=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();function it(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function at(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}var ot=function(e){function t(){return it(this,t),at(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),rt(t,[{key:"parse",value:function(e){e=String(e);var t=void 0;if(T.isInvalid(e))t=T.getInvalidType(e);else{var n=e.match(/^\s*([+-]?\d+(?:\.\d+)?)\s*-\s*([+-]?\d+(?:\.\d+)?)\s*$/);t=n?Number.parseFloat(n[1])+"-"+Number.parseFloat(n[2]):T.NA}return t}}]),t}(Be),ut=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();function ct(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function ft(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}var lt=function(e){function t(){return ct(this,t),ft(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),ut(t,[{key:"calculateDataDomain",value:function(){var e=this.partialField.schema.bins;return[e[0],e[e.length-1]]}},{key:"bins",value:function(){return this.partialField.schema.bins}}],[{key:"parser",value:function(){return new ot}}]),t}(Me),st=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();function pt(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function dt(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}var ht=function(e){function t(){return pt(this,t),dt(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),st(t,[{key:"parse",value:function(e){var t=void 0;if(T.isInvalid(e))t=T.getInvalidType(e);else{var n=parseFloat(e,10);t=Number.isNaN(n)?T.NA:n}return t}}]),t}(Be),vt=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();function yt(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function mt(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}var bt=function(e){function t(){return yt(this,t),mt(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),vt(t,[{key:"subtype",value:function(){return c.CONTINUOUS}},{key:"calculateDataDomain",value:function(){return et(this.partialField.data,this.rowDiffset)}}],[{key:"parser",value:function(){return new ht}}]),t}(Le),gt=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();function _t(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function wt(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var Ot=function(){function e(t){wt(this,e);var n=t instanceof Array?t.map(Number):[Number(t)];return this._val=new Set(n),this._hash=n[0],this._valArr=n,this}return gt(e,[{key:"toString",value:function(){return this._hash}},{key:"values",value:function(){return this._valArr}}]),e}(),Et=function(e){function t(){return wt(this,t),_t(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),gt(t,[{key:"parse",value:function(e){return new Ot(e instanceof Ot?e.values():e)}}]),t}(Be),jt=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();function At(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function kt(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}var Dt=function(e){function t(){return At(this,t),kt(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),jt(t,[{key:"subtype",value:function(){return u.ID}}],[{key:"parser",value:function(){return new Et}}]),t}(Xe),St=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();var Ft=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._fieldType=new Map}return St(e,[{key:"registerFieldType",value:function(e,t){return this._fieldType.set(e,t),this}},{key:"has",value:function(e){return this._fieldType.has(e)}},{key:"get",value:function(e){return this._fieldType.get(e)}}]),e}(),Nt=function(){var e=null;return e||(function(e){e.registerFieldType(u.CATEGORICAL,Xe).registerFieldType(u.ID,Dt).registerFieldType(u.TEMPORAL,nt).registerFieldType(u.BINNED,lt).registerFieldType(c.CONTINUOUS,bt)}(e=new Ft),e)}();function Tt(e,t,n){var r={};return n&&n.length||(n=t.map((function(e){return e.name}))),n.forEach((function(e,t){r[e]=t})),t.map((function(t){return function(e,t){return e=e||[],Nt.has(t.subtype)?Nt.get(t.subtype).BUILDER.fieldName(t.name).schema(t).data(e).rowDiffset("0-"+(e.length-1)).build():Nt.get(t.type===f.MEASURE?c.CONTINUOUS:u.CATEGORICAL).BUILDER.fieldName(t.name).schema(t).data(e).rowDiffset("0-"+(e.length-1)).build()}(e[r[t.name]],t)}))}var Pt={dataFormat:o.AUTO},It=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();var Ct=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._type=t}return It(e,[{key:"convert",value:function(){throw new Error("Convert method not implemented.")}},{key:"type",get:function(){return this._type}}]),e}(),Mt={},Rt={};function xt(e){return new Function("d","return {"+e.map((function(e,t){return JSON.stringify(e)+": d["+t+'] || ""'})).join(",")+"}")}function Ut(e){var t=Object.create(null),n=[];return e.forEach((function(e){for(var r in e)r in t||n.push(t[r]=r)})),n}function Lt(e,t){var n=e+"",r=n.length;return r<t?new Array(t-r+1).join(0)+n:n}function Vt(e){var t,n=e.getUTCHours(),r=e.getUTCMinutes(),i=e.getUTCSeconds(),a=e.getUTCMilliseconds();return isNaN(e)?"Invalid Date":((t=e.getUTCFullYear())<0?"-"+Lt(-t,6):t>9999?"+"+Lt(t,6):Lt(t,4))+"-"+Lt(e.getUTCMonth()+1,2)+"-"+Lt(e.getUTCDate(),2)+(a?"T"+Lt(n,2)+":"+Lt(r,2)+":"+Lt(i,2)+"."+Lt(a,3)+"Z":i?"T"+Lt(n,2)+":"+Lt(r,2)+":"+Lt(i,2)+"Z":r||n?"T"+Lt(n,2)+":"+Lt(r,2)+"Z":"")}var Bt=function(e){var t=new RegExp('["'+e+"\n\r]"),n=e.charCodeAt(0);function r(e,t){var r,i=[],a=e.length,o=0,u=0,c=a<=0,f=!1;function l(){if(c)return Rt;if(f)return f=!1,Mt;var t,r,i=o;if(34===e.charCodeAt(i)){for(;o++<a&&34!==e.charCodeAt(o)||34===e.charCodeAt(++o););return(t=o)>=a?c=!0:10===(r=e.charCodeAt(o++))?f=!0:13===r&&(f=!0,10===e.charCodeAt(o)&&++o),e.slice(i+1,t-1).replace(/""/g,'"')}for(;o<a;){if(10===(r=e.charCodeAt(t=o++)))f=!0;else if(13===r)f=!0,10===e.charCodeAt(o)&&++o;else if(r!==n)continue;return e.slice(i,t)}return c=!0,e.slice(i,a)}for(10===e.charCodeAt(a-1)&&--a,13===e.charCodeAt(a-1)&&--a;(r=l())!==Rt;){for(var s=[];r!==Mt&&r!==Rt;)s.push(r),r=l();t&&null==(s=t(s,u++))||i.push(s)}return i}function i(t,n){return t.map((function(t){return n.map((function(e){return o(t[e])})).join(e)}))}function a(t){return t.map(o).join(e)}function o(e){return null==e?"":e instanceof Date?Vt(e):t.test(e+="")?'"'+e.replace(/"/g,'""')+'"':e}return{parse:function(e,t){var n,i,a=r(e,(function(e,r){if(n)return n(e,r-1);i=e,n=t?function(e,t){var n=xt(e);return function(r,i){return t(n(r),i,e)}}(e,t):xt(e)}));return a.columns=i||[],a},parseRows:r,format:function(t,n){return null==n&&(n=Ut(t)),[n.map(o).join(e)].concat(i(t,n)).join("\n")},formatBody:function(e,t){return null==t&&(t=Ut(e)),i(e,t).join("\n")},formatRows:function(e){return e.map(a).join("\n")},formatRow:a,formatValue:o}};var Yt=function(e,t,n){if(!Array.isArray(t))throw new Error("Schema missing or is in an unsupported format");var r=t.map((function(e){return e.name}));n=Object.assign({},{firstRowHeader:!0},n);var i=[],a=v(i),o=r;n.firstRowHeader&&(o=e.splice(0,1)[0]);var u=o.reduce((function(e,t,n){return Object.assign(e,(a=n,(i=t)in(r={})?Object.defineProperty(r,i,{value:a,enumerable:!0,configurable:!0,writable:!0}):r[i]=a,r));var r,i,a}),{});return e.forEach((function(e){var t=[];return r.forEach((function(n){var r=u[n];t.push(e[r])})),a.apply(void 0,t)})),[r,i]};var Ht=function(e,t,n){n=Object.assign({},{firstRowHeader:!0,fieldSeparator:","},n);var r=Bt(n.fieldSeparator);return Yt(r.parseRows(e),t,n)},Jt=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();var Gt=function(e){function t(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,o.DSV_STR))}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),Jt(t,[{key:"convert",value:function(e,t,n){return Ht(e,t,n)}}]),t}(Ct);var zt=function(e,t){if(!Array.isArray(t))throw new Error("Schema missing or is in an unsupported format");var n={},r=0,i=void 0,a=[],o=v(a),u=t.map((function(e){return e.name}));return e.forEach((function(e){var t=[];u.forEach((function(a){a in n?i=n[a]:(n[a]=r++,i=r-1),t[i]=e[a]})),o.apply(void 0,t)})),[Object.keys(n),a]},Kt=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();var Wt=function(e){function t(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,o.FLAT_JSON))}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),Kt(t,[{key:"convert",value:function(e,t,n){return zt(e,t,n)}}]),t}(Ct),Xt=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();var qt=function(e){function t(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,o.DSV_ARR))}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),Xt(t,[{key:"convert",value:function(e,t,n){return Yt(e,t,n)}}]),t}(Ct);var Zt=function(e,t,n){var r={FlatJSON:zt,DSVStr:Ht,DSVArr:Yt},i=j(e);if(!i)throw new Error("Couldn't detect the data format");return r[i](e,t,n)},$t=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();var Qt=function(e){function t(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,o.AUTO))}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),$t(t,[{key:"convert",value:function(e,t,n){return Zt(e,t,n)}}]),t}(Ct),en=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();var tn,nn,rn=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.store=new Map,this.converters(this._getDefaultConverters())}return en(e,[{key:"_getDefaultConverters",value:function(){return[new Gt,new qt,new Wt,new Qt]}},{key:"converters",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];return t.forEach((function(t){return e.store.set(t.type,t)})),this.store}},{key:"register",value:function(e){return e instanceof Ct?(this.store.set(e.type,e),this):null}},{key:"unregister",value:function(e){return this.store.delete(e.type),this}},{key:"get",value:function(e){return this.store.has(e)?this.store.get(e):null}}]),e}(),an=function(){var e=null;return e||(e=new rn)}(),on=function(e,t){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return function(e,t){var n=[],r=!0,i=!1,a=void 0;try{for(var o,u=e[Symbol.iterator]();!(r=(o=u.next()).done)&&(n.push(o.value),!t||n.length!==t);r=!0);}catch(e){i=!0,a=e}finally{try{!r&&u.return&&u.return()}finally{if(i)throw a}}return n}(e,t);throw new TypeError("Invalid attempt to destructure non-iterable instance")};function un(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function cn(e){if(Array.isArray(e)){for(var t=0,n=Array(e.length);t<e.length;t++)n[t]=e[t];return n}return Array.from(e)}function fn(e){var t={};for(var n in e)t[n]=new D(e[n].formattedValue,e[n].rawValue,n);return t}var ln=function(e,t,n){var r=on(e,2),i=r[0],a=r[1],o=a.length?a.split(","):[],l=t.fieldsObj(),s=o.map((function(e){return function(e,t){var n=e.schema;return Nt.has(n.subtype)?Nt.get(n.subtype).BUILDER.partialField(e).rowDiffset(t).build():Nt.get(n.type===f.MEASURE?c.CONTINUOUS:u.CATEGORICAL).BUILDER.partialField(e).rowDiffset(t).build()}(l[e].partialField,i)}));return A.createNamespace(s,n)},sn=function(e,t){var n,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},i=arguments[3];t===M.COMPOSE?(e._derivation.length=0,(n=e._derivation).push.apply(n,cn(i))):e._derivation.push({op:t,meta:r,criteria:i})},pn=function(e,t){var n;(n=t._ancestorDerivation).push.apply(n,cn(e._ancestorDerivation).concat(cn(e._derivation)))},dn=function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},i=arguments[4];sn(t,n,r,i),pn(e,t)},hn=(un(tn={},l.NORMAL,{diffIndex:["rowDiffset"],calcDiff:[!0,!1]}),un(tn,l.INVERSE,{diffIndex:["rejectRowDiffset"],calcDiff:[!1,!0]}),un(tn,l.ALL,{diffIndex:["rowDiffset","rejectRowDiffset"],calcDiff:[!0,!0]}),tn),vn=function(e,t,n){if(-1!==n&&t===n+1){var r=e.length-1;e[r]=e[r].split("-")[0]+"-"+t}else e.push(""+t)},yn=function(e,t,n){var r=[],i=[],a=on(hn[n].calcDiff,2),o=a[0],u=a[1];return S(e,(function(e){var n=t(e);n&&o&&vn(r,e,-1),!n&&u&&vn(i,e,-1)})),{rowDiffset:r.join(","),rejectRowDiffset:i.join(",")}},mn=function(e,t,n,r,i){var a={},o={},u={};return S(e,(function(e){if(t(e)){var n="",c={keys:{}};r.forEach((function(t){var r=i[t].partialField.data[e];n=n+"-"+r,c.keys[t]=r})),void 0===o[n]&&(o[n]=[],a[n]=-1,u[n]=c),vn(o[n],e,a[n]),a[n]=e}})),{splitRowDiffset:o,dimensionMap:u}},bn=function(e,t,n,r,i){var a={},o=function(){return r.detachedRoot()},u=n.mode,c=e._rowDiffset,f=e._partialFieldspace._cachedValueObjects;return i(c,(function(e){return t(f[e],e,o,a)}),u)},gn=function(e){var t=e.clone(!1),n=e.getPartialFieldspace();return t._colIdentifier=n.fields.map((function(e){return e.name()})).join(","),n._cachedFieldsObj=null,n._cachedDimension=null,n._cachedMeasure=null,t.__calculateFieldspace().calculateFieldsConfig(),t},_n=function(e,t,n,r){for(var i=n(e,t,0,r),a=1,o=e.length;a<o;a++)i=i+","+n(e,t,a,r);return i},wn=function(e,t,n,r){var i=e[n];return i===C?r:t[i].internalValue},On=function(e,t){return(t[0]instanceof Array?t:[t]).some((function(t){return e>=t[0]&&e<=t[1]}))},En=(un(nn={},c.CONTINUOUS,On),un(nn,u.TEMPORAL,On),nn),jn=function(e,t,n){return En[n](e,t)},An=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=[],i=n.operation||L,a=n.filterByDim,o=void 0===a||a,u=n.filterByMeasure,c=void 0!==u&&u,l=n.clone,s=void 0===l||l,p=s?gn(e):e,d=p.getFieldsConfig(),h=e.getPartialFieldspace().idField.data();r=t.length?t.map((function(e){return function(e){var t=e.criteria,n=void 0===t?{}:t,r=n.identifiers,i=void 0===r?[[],[]]:r,a=n.range,u=on(i,2),l=u[0],s=void 0===l?[]:l,p=u[1],v=void 0===p?[]:p,y=s.reduce((function(e,t,n){return e[t]=n,e}),{}),m=(s=s.filter((function(e){return e in d&&d[e].def.type===f.DIMENSION||e===C}))).length,b={};if(m)for(var g=function(e,t){var n=i[e],r=void 0;if(C in y){var a=n[y.__id__];a&&a.values().forEach((function(e){r=""+s.map((function(t){var r=y[t];return t===C?e:n[r]})),b[r]=1}))}else r=""+s.map((function(e){var t=y[e];return n[t]})),b[r]=1},_=1,w=i.length;_<w;_++)g(_);var O=Object.keys(a||{}).filter((function(e){return e in d})),E=v.length||O.length;return c||(O=O.filter((function(e){return d[e].def.type!==f.MEASURE}))),o||(O=O.filter((function(e){return d[e].def.type!==f.DIMENSION}))),E?function(e,t){var n=!0;return o&&(n=!m||b[_n(s,e,wn,h[t])]),O.every((function(t){var n=e[t].internalValue;return jn(n,a[t],d[t].def.subtype)}))&&n}:function(){return!1}}(e)})):[function(){return!1}];return i===L?p.select((function(e,t){return r.every((function(n){return n(e,t)}))}),{saveChild:!1}):p.select((function(e,t){return r.some((function(n){return n(e,t)}))}),{saveChild:!1})},kn=function(e,t,n,r,i){e._rowDiffset=t,e.__calculateFieldspace().calculateFieldsConfig(),dn(n,e,M.SELECT,{config:r},i)},Dn=function(e,t,n,r){var i=e.clone(n.saveChild),a=t;return n.mode===l.INVERSE&&(a=r.filter((function(e){return-1===t.indexOf(e)}))),i._colIdentifier=a.join(","),i.__calculateFieldspace().calculateFieldsConfig(),dn(e,i,M.PROJECT,{projField:t,config:n,actualProjField:a},null),i},Sn=function(e,t,n,r){return t.map((function(t){return Dn(e,t,n,r)}))},Fn=function(e){if((e=g({},e)).type||(e.type=f.DIMENSION),!e.subtype)switch(e.type){case f.MEASURE:e.subtype=c.CONTINUOUS;break;default:case f.DIMENSION:e.subtype=u.CATEGORICAL}return e},Nn=function(e){return e.map((function(e){return function(e){var t=e.type,n=e.subtype,r=e.name;if(t!==f.DIMENSION&&t!==f.MEASURE)throw new Error("DataModel doesn't support field type "+t+" used for "+r+" field");if(!Nt.has(n))throw new Error("DataModel doesn't support measure field subtype "+n+" used for "+r+" field")}(e=Fn(e)),e}))},Tn=function(e,t,n,r){n=Nn(n),r=Object.assign(Object.assign({},Pt),r);var i=an.get(r.dataFormat);if(!i)throw new Error("No converter function found for "+r.dataFormat+" format");var a=i.convert(t,n,r),c=on(a,2),f=c[0],l=c[1];!function(e,t){e.forEach((function(e){var n=e.as;if(n){var r=t.indexOf(e.name);t[r]=n,e.name=n,delete e.as}}))}(n,f);var s=n.findIndex((function(e){return e.subtype===u.ID})),p=void 0;if(-1!==s)p=l[s]||[],l=l.filter((function(e,t){return t!==s})),f=f.filter((function(e,t){return t!==s})),n=n.filter((function(e){return e.subtype!==u.ID}));else{var d=l[0]&&l[0].length||0;p=new Array(d).fill().map((function(e,t){return t}))}var h=Tt(l,n,f),v=Tt([p],[{name:C,type:"dimension",subtype:u.ID}],[C])[0],y=A.createNamespace(h,r.name,v);e._partialFieldspace=y,e._rowDiffset=l.length&&l[0].length?"0-"+(l[0].length-1):"";var m=[],b=y.fields,g=b.map((function(e){return e.data()})),_=b.map((function(e){return e.formattedData()})),w=v.data();return S(e._rowDiffset,(function(e){m[e]=function(e,t,n,r){var i={},a=!0,o=!1,u=void 0;try{for(var c,f=e.entries()[Symbol.iterator]();!(a=(c=f.next()).done);a=!0){var l=c.value,s=on(l,2),p=s[0],d=s[1];i[d.name()]=new D(t[p][r],n[p][r],d)}}catch(e){o=!0,u=e}finally{try{!a&&f.return&&f.return()}finally{if(o)throw u}}return i}(b,_,g,e),m[e].__id__=new D(w[e],w[e],v)})),y._cachedValueObjects=m,e._colIdentifier=n.map((function(e){return e.name})).join(),e._dataFormat=r.dataFormat===o.AUTO?j(t):r.dataFormat,e},Pn=function(e,t){for(var n=0;n<e.length;++n)if(t===e[n].name)return{name:t,type:e[n].subtype||e[n].type,index:n};return null},In=function(e,t){var n=t.getDerivations(),r=e;return n.forEach((function(e){if(e){var t,n=function(e){var t=[],n=void 0;switch(n=e.op){case M.SELECT:t=[e.criteria];break;case M.PROJECT:t=[e.meta.actualProjField];break;case M.SORT:t=[e.criteria];break;case M.GROUPBY:n="groupBy",t=[e.meta.groupByString.split(","),e.criteria];break;default:n=null}return{operation:n,params:t}}(e),i=n.operation,a=n.params;if(i)r=(t=r)[i].apply(t,cn(a).concat([{saveChild:!1}]))}})),r},Cn=function(e){for(;e._parent&&e._derivation.find((function(e){return e.op!==M.GROUPBY}));)e=e._parent;return e},Mn=function(e){for(;e._parent;)e=e._parent;return e},Rn=function(e){for(var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];e._parent;)t.push(e),e=e._parent;return t},xn=function(e,t,n,r){var i=void 0,a=n.propagationNameSpace,o=n.propagateToSource,u=n.sourceId,c=function(e){var t=e.config,n=e.model,r=t.criteria,i=void 0;return null!==r&&r.fields.some((function(e){return e.type===f.MEASURE}))&&(i=Cn(n)),Object.assign({},t,{groupedModel:i})},l=[];if(null===e)l=[{criteria:[]}],i=[];else{var s,p=Object.values(a.mutableActions);!1!==o&&(p=p.filter((function(e){return e.config.sourceId!==u})));var d=p.filter((function(e){return(r.filterFn||function(){return!0})(e,r)})),h=[];if(!1!==o){var v=Object.values(a.mutableActions);v.forEach((function(e){var t=e.config;!1===t.applyOnSource&&t.action===r.action&&t.sourceId!==u&&(h.push(e.model),(i=v.filter((function(t){return t!==e})).map(c)).length&&l.push({criteria:i,models:e.model,path:Rn(e.model)}))}))}i=(s=[]).concat.apply(s,[].concat(cn(d.map(c)),[{criteria:e,groupedModel:null!==e&&e.fields.some((function(e){return e.type===f.MEASURE}))?Cn(n.propagationSource):null}])).filter((function(e){return null!==e})),l.push({criteria:i,excludeModels:[].concat(h,cn(r.excludeModels||[]))})}var y=t.model,m=Object.assign({sourceIdentifiers:e,propagationSourceId:u},r);l.forEach((function(e){var t=e.criteria,n=An(y,t,{filterByMeasure:!!t.find((function(e){return e.groupedModel===y}))}),r=e.path;if(r){var i=function(e,t){for(var n=0,r=t.length;n<r;n++){var i=t[n];e=In(e,i)}return e}(n,r.reverse());e.models.handlePropagation(i,m)}else!function e(t,n){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},a=i.excludeModels||[],o=i.criteria,u=!a.length||-1===a.indexOf(t);u&&t.handlePropagation(n,r);var c=t._children;c.forEach((function(t){var a=o.filter((function(e){return e.groupedModel===t})),u=In(n,t);a.length&&(u=An(u,a,{filterByDim:!1,filterByMeasure:!0,clone:!1})),e(t,u,r,i)}))}(y,n,m,{excludeModels:e.excludeModels,criteria:t})}))},Un=function(e,t,n){var r=e.immutableActions;for(var i in r){var a=r[i],o=a.config,u=n.config.sourceId,c=!n.propConfig.filterImmutableAction||n.propConfig.filterImmutableAction(o,n.config);if(o.sourceId!==u&&c){var f=o.criteria;xn(f,{model:t,groupByModel:Cn(a.model)},{propagationNameSpace:e,propagateToSource:!1,sourceId:u,propagationSource:a.model},o)}}},Ln=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments[2],r=void 0,i=t.isMutableAction,a=t.criteria,o=t.action+"-"+t.sourceId;r=i?e.mutableActions:e.immutableActions,null===a?delete r[o]:r[o]={model:n,config:t}},Vn=function(e,t,n){var r=e.reduce((function(e,r){return"RegExp"===r.constructor.name?e.push.apply(e,cn(t.filter((function(e){return-1!==e.search(r)})))):r in n&&e.push(r),e}),[]);return Array.from(new Set(r)).map((function(e){return e.trim()}))},Bn=function(e,t){return e.numberFormat?e.numberFormat()(t):t},Yn=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();function Hn(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var Jn=function(){function e(){Hn(this,e);var t=void 0;this._parent=null,this._derivation=[],this._ancestorDerivation=[],this._children=[];for(var n=arguments.length,r=Array(n),i=0;i<n;i++)r[i]=arguments[i];1===r.length&&(t=r[0])instanceof e?(this._colIdentifier=t._colIdentifier,this._rowDiffset=t._rowDiffset,this._dataFormat=t._dataFormat,this._parent=t,this._partialFieldspace=this._parent._partialFieldspace,this._fieldStoreName=w(),this.__calculateFieldspace().calculateFieldsConfig()):(Tn.apply(void 0,[this].concat(r)),this._fieldStoreName=this._partialFieldspace.name,this.__calculateFieldspace().calculateFieldsConfig(),this._propagationNameSpace={mutableActions:{},immutableActions:{}})}return Yn(e,[{key:"getSchema",value:function(){return this.getFieldspace().fields.map((function(e){return e.schema()}))}},{key:"getName",value:function(){return this._fieldStoreName}},{key:"getFieldspace",value:function(){return this._fieldspace}},{key:"__calculateFieldspace",value:function(){return this._fieldspace=ln([this._rowDiffset,this._colIdentifier],this.getPartialFieldspace(),this._fieldStoreName),this}},{key:"getPartialFieldspace",value:function(){return this._partialFieldspace}},{key:"join",value:function(e,t){return H(this,e,t)}},{key:"naturalJoin",value:function(e){return H(this,e,je(this,e),!0)}},{key:"union",value:function(e){return Ae(this,e)}},{key:"difference",value:function(e){return ne(this,e)}},{key:"select",value:function(e,t){var n={mode:l.NORMAL,saveChild:!0};return(t=Object.assign({},n,t)).mode=t.mode||n.mode,function(e,t,n,r){var i={},a=n.mode,o=e.clone(r.saveChild),u=bn(o,t,n,e,yn),c=hn[a].diffIndex;return kn(o,u[c[0]],e,n,t),c.length>1?(i=e.clone(r.saveChild),kn(i,u[c[1]],e,n,t),[o,i]):o}(this,e,t,{saveChild:t.saveChild})}},{key:"isEmpty",value:function(){return!this._rowDiffset.length||!this._colIdentifier.length}},{key:"clone",value:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],t=new this.constructor(this);return e?t.setParent(this):t.setParent(null),t}},{key:"project",value:function(e,t){var n={mode:l.NORMAL,saveChild:!0};t=Object.assign({},n,t);var r=this.getFieldsConfig(),i=Object.keys(r),a=t.mode,o=Vn(e,i,r),u=void 0;a===l.ALL?u=[Dn(this,o,{mode:l.NORMAL,saveChild:t.saveChild},i),Dn(this,o,{mode:l.INVERSE,saveChild:t.saveChild},i)]:u=Dn(this,o,t,i);return u}},{key:"getFieldsConfig",value:function(){return this._fieldConfig}},{key:"calculateFieldsConfig",value:function(){return this._fieldConfig=this._fieldspace.fields.reduce((function(e,t,n){return e[t.name()]={index:n,def:t.schema()},e}),{}),this}},{key:"dispose",value:function(){this._parent&&this._parent.removeChild(this),this._parent=null,this._children.forEach((function(e){e._parent=null})),this._children=[]}},{key:"removeChild",value:function(e){var t=this._children.findIndex((function(t){return t===e}));-1===t||this._children.splice(t,1)}},{key:"setParent",value:function(e){this._parent&&this._parent.removeChild(this),this._parent=e,e&&e._children.push(this)}},{key:"getParent",value:function(){return this._parent}},{key:"getChildren",value:function(){return this._children}},{key:"getDerivations",value:function(){return this._derivation}},{key:"getAncestorDerivations",value:function(){return this._ancestorDerivation}}]),e}(),Gn=function(e,t){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return function(e,t){var n=[],r=!0,i=!1,a=void 0;try{for(var o,u=e[Symbol.iterator]();!(r=(o=u.next()).done)&&(n.push(o.value),!t||n.length!==t);r=!0);}catch(e){i=!0,a=e}finally{try{!r&&u.return&&u.return()}finally{if(i)throw a}}return n}(e,t);throw new TypeError("Invalid attempt to destructure non-iterable instance")},zn=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();function Kn(e){if(Array.isArray(e)){for(var t=0,n=Array(e.length);t<e.length;t++)n[t]=e[t];return n}return Array.from(e)}function Wn(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function Xn(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}var qn=function(e){function t(){var e;Wn(this,t);for(var n=arguments.length,r=Array(n),i=0;i<n;i++)r[i]=arguments[i];var a=Xn(this,(e=t.__proto__||Object.getPrototypeOf(t)).call.apply(e,[this].concat(r)));return a._onPropagation=[],a}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),zn(t,[{key:"getData",value:function(e){e=Object.assign({},{order:"row",formatter:null,withUid:!1,getAllFields:!1,sort:[]},e);var t=this.getPartialFieldspace(),n=t.idField,r=t.fields,i=te.call(this,{fields:r,idField:n},this._rowDiffset,e.getAllFields?r.map((function(e){return e.name()})).join():this._colIdentifier,e.sort,{columnWise:"column"===e.order,addUid:!!e.withUid});if(!e.formatter)return i;var a=e.formatter,o=i.data,u=i.schema,c=i.uids,f=u.map((function(e){return e.name})),l=Object.keys(a).reduce((function(e,t){var n=f.indexOf(t);return-1!==n&&e.push([n,a[t]]),e}),[]);return"column"===e.order?l.forEach((function(e){var t=e[0],n=e[1];o[t].forEach((function(e,r){o[t][r]=n.call(void 0,e,c[r],u[t])}))})):o.forEach((function(e,t){l.forEach((function(n){var r=n[0],i=n[1];e[r]=i.call(void 0,e[r],c[t],u[r])}))})),i}},{key:"getUids",value:function(){var e=this._rowDiffset,t=[],n=this.getPartialFieldspace().idField.data();return S(e,(function(e){t.push(n[e])})),t}},{key:"groupBy",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{saveChild:!0},r=""+e.join(),i=[this,e,t],a=Ee.apply(void 0,i);return dn(this,a,M.GROUPBY,{fieldsArr:e,groupByString:r,defaultReducer:we.defaultReducer()},t),n.saveChild?a.setParent(this):a.setParent(null),a}},{key:"sort",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{saveChild:!1},n=this.getData({order:"row",sort:e,withUid:!0}),r=n.schema.map((function(e){return e.name})),i=[r].concat(n.data),a=new this.constructor(i,n.schema,{dataFormat:"DSVArr"});return dn(this,a,M.SORT,t,e),t.saveChild?a.setParent(this):a.setParent(null),a}},{key:"serialize",value:function(e,t){e=e||this._dataFormat,t=Object.assign({},{fieldSeparator:","},t);var n=this.getFieldspace().fields,r=n.map((function(e){return e.formattedData()})),i=r[0].length,a=void 0,u=void 0,c=void 0;if(e===o.FLAT_JSON)for(a=[],u=0;u<i;u++){var f={};for(c=0;c<n.length;c++)f[n[c].name()]=r[c][u];a.push(f)}else if(e===o.DSV_STR){for(a=[n.map((function(e){return e.name()})).join(t.fieldSeparator)],u=0;u<i;u++){var l=[];for(c=0;c<n.length;c++)l.push(r[c][u]);a.push(l.join(t.fieldSeparator))}a=a.join("\n")}else{if(e!==o.DSV_ARR)throw new Error("Data type "+e+" is not supported");for(a=[n.map((function(e){return e.name()}))],u=0;u<i;u++){var s=[];for(c=0;c<n.length;c++)s.push(r[c][u]);a.push(s)}}return a}},{key:"addField",value:function(e){var t=e.name();this._colIdentifier+=","+t;var n=this._partialFieldspace,r=n._cachedValueObjects,i=e.formattedData(),a=e.partialField.data;if(n.fieldsObj()[e.name()]){var o=n.fields.findIndex((function(e){return e.name()===t}));o>=0&&(n.fields[o]=e)}else n.fields.push(e),r.forEach((function(t,n){t[e.name()]=new D(i[n],a[n],e)}));return n._cachedFieldsObj=null,n._cachedDimension=null,n._cachedMeasure=null,this.__calculateFieldspace().calculateFieldsConfig(),this}},{key:"calculateVariable",value:function(e,t,n){var r=this;e=Fn(e),n=Object.assign({},{saveChild:!0,replaceVar:!1},n);var i=this.getFieldsConfig(),a=t.slice(0,t.length-1),o=t[t.length-1];if(i[e.name]&&!n.replaceVar)throw new Error(e.name+" field already exists in datamodel");var u=a.map((function(e){var t=i[e];if(!t)throw new Error(e+" is not a valid column name.");return t.index})),c=this.clone(n.saveChild),f=c.getFieldspace().fields,l=u.map((function(e){return f[e]})),s={},p=function(){return r.detachedRoot()},d=[];S(c._rowDiffset,(function(e){var t=l.map((function(t){return t.partialField.data[e]}));d[e]=o.apply(void 0,Kn(t).concat([e,p,s]))}));var h=Tt([d],[e],[e.name]),v=Gn(h,1)[0];return c.addField(v),dn(this,c,M.CAL_VAR,{config:e,fields:a},o),c}},{key:"propagate",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments[2],r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},i=t.isMutableAction,a=t.sourceId,o=t.payload,u=Mn(this),c=u._propagationNameSpace,f=Cn(this),l={groupByModel:f,model:u};return n&&Ln(c,t,this),xn(e,l,{propagationNameSpace:c,sourceId:a,propagationSource:this},Object.assign({payload:o},t)),i&&Un(c,u,{config:t,propConfig:r}),this}},{key:"on",value:function(e,t){switch(e){case"propagation":this._onPropagation.push(t)}return this}},{key:"unsubscribe",value:function(e){switch(e){case"propagation":this._onPropagation=[]}return this}},{key:"handlePropagation",value:function(e,t){var n=this;this._onPropagation.forEach((function(r){return r.call(n,e,t)}))}},{key:"bin",value:function(e,t){var n=this.getFieldsConfig();if(!n[e])throw new Error("Field "+e+" doesn't exist");var r=t.name||e+"_binned";if(n[r])throw new Error("Field "+r+" already exists");var i=I(this.getFieldspace().fieldsObj()[e],this._rowDiffset,t),a=i.binnedData,o=i.bins,c=Tt([a],[{name:r,type:f.DIMENSION,subtype:u.BINNED,bins:o}],[r])[0],l=this.clone(t.saveChild);return l.addField(c),dn(this,l,M.BIN,{measureFieldName:e,config:t,binFieldName:r},null),l}},{key:"detachedRoot",value:function(){return new t(this.serialize(o.FLAT_JSON),this.getSchema())}},{key:"splitByRow",value:function(e,t,n){var r=this.getFieldsConfig();e.forEach((function(e){if(!r[e])throw new Error("Field "+e+" doesn't exist in the schema")}));var i={mode:l.NORMAL,saveChild:!0};return function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:function(e){return e},r=arguments[3],i=r.saveChild,a=e.getFieldspace().fieldsObj(),o=bn(e.clone(i),n,r,e,(function(){for(var e=arguments.length,n=Array(e),r=0;r<e;r++)n[r]=arguments[r];return mn.apply(void 0,n.concat([t,a]))})),u=o.splitRowDiffset,c=o.dimensionMap,f=[];return Object.keys(u).sort().forEach((function(n){if(u[n]){var a=e.clone(i),o=c[n];a._rowDiffset=u[n].join(","),a.__calculateFieldspace().calculateFieldsConfig();i&&dn(e,a,M.SELECT,r,(function(e){return t.every((function(t){return e[t].internalValue===o.keys[t]}))})),a._derivation[a._derivation.length-1].meta=c[n],f.push(a)}})),f}(this,e,t,n=Object.assign({},i,n))}},{key:"splitByColumn",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],n=arguments[2],r={mode:l.NORMAL,saveChild:!0},i=this.getFieldsConfig(),a=Object.keys(i),o=[[t]];return n=Object.assign({},r,n),(e=e.length?e:[[]]).forEach((function(e,n){o[n]=Vn([].concat(Kn(e),Kn(t)),a,i)})),Sn(this,o,n,a)}}],[{key:"configureInvalidAwareTypes",value:function(e){return T.invalidAwareVals(e)}},{key:"Reducers",get:function(){return we}},{key:"Converters",get:function(){return an}},{key:"FieldTypes",get:function(){return Nt}}]),t}(Jn),Zn=ye.sum,$n=ye.avg,Qn=ye.min,er=ye.max,tr=ye.first,nr=ye.last,rr=ye.count,ir=ye.std,ar={compose:function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];return function(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{saveChild:!0},r=e,i=void 0,a=[];return t.forEach((function(e){r=e(r),a.push.apply(a,V(r._derivation)),i||(i=r)})),i&&i!==r&&i.dispose(),r._ancestorDerivation=[],dn(e,r,M.COMPOSE,null,a),n.saveChild?r.setParent(e):r.setParent(null),r}},bin:function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];return function(e){return e.bin.apply(e,t)}},select:function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];return function(e){return e.select.apply(e,t)}},project:function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];return function(e){return e.project.apply(e,t)}},groupBy:function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];return function(e){return e.groupBy.apply(e,t)}},calculateVariable:function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];return function(e){return e.calculateVariable.apply(e,t)}},sort:function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];return function(e){return e.sort.apply(e,t)}},crossProduct:H,difference:ne,naturalJoin:function(e,t){return H(e,t,je(e,t),!0)},leftOuterJoin:ke,rightOuterJoin:De,fullOuterJoin:function(e,t,n){return Ae(ke(e,t,n),De(e,t,n))},union:Ae,rowDiffsetIterator:S},or=n(0).version;Object.assign(qn,{Operators:ar,Stats:a,DM_DERIVATIVES:M,DateTimeFormatter:h,DataFormat:o,FilteringMode:l,InvalidAwareTypes:T,version:or,DataConverter:Ct,FieldsUtility:i},r);var ur=t.default=qn}])}));
//# sourceMappingURL=datamodel.js.map