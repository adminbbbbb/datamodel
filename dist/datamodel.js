!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define("DataModel",[],t):"object"==typeof exports?exports.DataModel=t():e.DataModel=t()}(window,function(){return function(e){var t={};function n(r){if(t[r])return t[r].exports;var a=t[r]={i:r,l:!1,exports:{}};return e[r].call(a.exports,a,a.exports,n),a.l=!0,a.exports}return n.m=e,n.c=t,n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var a in e)n.d(r,a,function(t){return e[t]}.bind(null,a));return r},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=1)}([function(e){e.exports={name:"datamodel",description:"Relational algebra compliant in-memory tabular data store",homepage:"https://github.com/chartshq/datamodel",version:"2.2.1",license:"MIT",main:"dist/datamodel.js",keywords:["datamodel","data","relational","algebra","model","muze","fusioncharts","table","tabular","operation"],author:"Muzejs.org (https://muzejs.org/)",repository:{type:"git",url:"https://github.com/chartshq/datamodel.git"},contributors:[{name:"Akash Goswami",email:"akashgoswami90s@gmail.com"},{name:"Subhash Haldar"},{name:"Rousan Ali",email:"rousanali786@gmail.com",url:"https://rousan.io"},{name:"Ujjal Kumar Dutta",email:"duttaujjalkumar@live.com"}],dependencies:{"d3-dsv":"^1.0.8"},devDependencies:{"babel-cli":"6.26.0","babel-core":"^6.26.3","babel-eslint":"6.1.2","babel-loader":"^7.1.4","babel-plugin-transform-runtime":"^6.23.0","babel-preset-env":"^1.7.0","babel-preset-es2015":"^6.24.1","babel-preset-flow":"^6.23.0",chai:"3.5.0","cross-env":"^5.0.5",eslint:"3.19.0","eslint-config-airbnb":"15.1.0","eslint-plugin-import":"2.7.0","eslint-plugin-jsx-a11y":"5.1.1","eslint-plugin-react":"7.3.0","istanbul-instrumenter-loader":"^3.0.0",jsdoc:"3.5.5",json2yaml:"^1.1.0",karma:"1.7.1","karma-chai":"0.1.0","karma-chrome-launcher":"2.1.1","karma-coverage-istanbul-reporter":"^1.3.0","karma-mocha":"1.3.0","karma-spec-reporter":"0.0.31","karma-webpack":"2.0.3",marked:"^0.5.0",mocha:"3.4.2","mocha-webpack":"0.7.0","transform-runtime":"0.0.0",webpack:"^4.12.0","webpack-cli":"^3.0.7","webpack-dev-server":"^3.1.4"},scripts:{test:"npm run lint && npm run ut",ut:"karma start karma.conf.js",utd:"karma start --single-run false --browsers Chrome karma.conf.js ",build:"npm run build:prod","build:dev":"webpack --mode development","build:prod":"webpack --mode production",start:"webpack-dev-server --config webpack.config.dev.js --mode development --open",lint:"eslint ./src","lint-errors":"eslint --quiet ./src",docs:"rm -rf yaml && mkdir yaml && jsdoc -c jsdoc.conf.json"}}},function(e,t,n){var r=n(2);e.exports=r.default?r.default:r},function(e,t,n){"use strict";n.r(t);var r={};n.r(r),n.d(r,"DataFormat",function(){return o}),n.d(r,"DimensionSubtype",function(){return u}),n.d(r,"MeasureSubtype",function(){return c}),n.d(r,"FieldType",function(){return f}),n.d(r,"FilteringMode",function(){return l}),n.d(r,"GROUP_BY_FUNCTIONS",function(){return s});var a={};n.r(a),n.d(a,"DSVArr",function(){return tt}),n.d(a,"DSVStr",function(){return ht}),n.d(a,"FlatJSON",function(){return vt}),n.d(a,"Auto",function(){return yt});var i={};n.r(i),n.d(i,"sum",function(){return qt}),n.d(i,"avg",function(){return Zt}),n.d(i,"min",function(){return $t}),n.d(i,"max",function(){return Qt}),n.d(i,"first",function(){return en}),n.d(i,"last",function(){return tn}),n.d(i,"count",function(){return nn}),n.d(i,"sd",function(){return rn});var o={FLAT_JSON:"FlatJSON",DSV_STR:"DSVStr",DSV_ARR:"DSVArr",AUTO:"Auto"},u={CATEGORICAL:"categorical",TEMPORAL:"temporal",GEO:"geo",BINNED:"binned"},c={CONTINUOUS:"continuous"},f={MEASURE:"measure",DIMENSION:"dimension"},l={NORMAL:"normal",INVERSE:"inverse",ALL:"all"},s={SUM:"sum",AVG:"avg",MIN:"min",MAX:"max",FIRST:"first",LAST:"last",COUNT:"count",STD:"std"};function d(e){return e instanceof Date?e:new Date(e)}function p(e){return e<10?"0"+e:e}function h(e){this.format=e,this.dtParams=void 0,this.nativeDate=void 0}RegExp.escape=function(e){return e.replace(/[-[\]{}()*+?.,\\^$|#\s]/g,"\\$&")},h.TOKEN_PREFIX="%",h.DATETIME_PARAM_SEQUENCE={YEAR:0,MONTH:1,DAY:2,HOUR:3,MINUTE:4,SECOND:5,MILLISECOND:6},h.defaultNumberParser=function(e){return function(t){var n;return isFinite(n=parseInt(t,10))?n:e}},h.defaultRangeParser=function(e,t){return function(n){var r,a=void 0;if(!n)return t;var i=n.toLowerCase();for(a=0,r=e.length;a<r;a++)if(e[a].toLowerCase()===i)return a;return void 0===a?t:null}},h.getTokenDefinitions=function(){var e={short:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],long:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"]},t={short:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],long:["January","February","March","April","May","June","July","August","September","October","November","December"]};return{H:{name:"H",index:3,extract:function(){return"(\\d+)"},parser:h.defaultNumberParser(),formatter:function(e){return d(e).getHours().toString()}},l:{name:"l",index:3,extract:function(){return"(\\d+)"},parser:h.defaultNumberParser(),formatter:function(e){var t=d(e).getHours()%12;return(0===t?12:t).toString()}},p:{name:"p",index:3,extract:function(){return"(AM|PM)"},parser:function(e){return e?e.toLowerCase():null},formatter:function(e){return d(e).getHours()<12?"AM":"PM"}},P:{name:"P",index:3,extract:function(){return"(am|pm)"},parser:function(e){return e?e.toLowerCase():null},formatter:function(e){return d(e).getHours()<12?"am":"pm"}},M:{name:"M",index:4,extract:function(){return"(\\d+)"},parser:h.defaultNumberParser(),formatter:function(e){return p(d(e).getMinutes())}},S:{name:"S",index:5,extract:function(){return"(\\d+)"},parser:h.defaultNumberParser(),formatter:function(e){return p(d(e).getSeconds())}},K:{name:"K",index:6,extract:function(){return"(\\d+)"},parser:h.defaultNumberParser(),formatter:function(e){return d(e).getMilliseconds().toString()}},a:{name:"a",index:2,extract:function(){return"("+e.short.join("|")+")"},parser:h.defaultRangeParser(e.short),formatter:function(t){var n=d(t).getDay();return e.short[n].toString()}},A:{name:"A",index:2,extract:function(){return"("+e.long.join("|")+")"},parser:h.defaultRangeParser(e.long),formatter:function(t){var n=d(t).getDay();return e.long[n].toString()}},e:{name:"e",index:2,extract:function(){return"(\\d+)"},parser:h.defaultNumberParser(),formatter:function(e){return d(e).getDate().toString()}},d:{name:"d",index:2,extract:function(){return"(\\d+)"},parser:h.defaultNumberParser(),formatter:function(e){return p(d(e).getDate())}},b:{name:"b",index:1,extract:function(){return"("+t.short.join("|")+")"},parser:h.defaultRangeParser(t.short),formatter:function(e){var n=d(e).getMonth();return t.short[n].toString()}},B:{name:"B",index:1,extract:function(){return"("+t.long.join("|")+")"},parser:h.defaultRangeParser(t.long),formatter:function(e){var n=d(e).getMonth();return t.long[n].toString()}},m:{name:"m",index:1,extract:function(){return"(\\d+)"},parser:function(e){return h.defaultNumberParser()(e)-1},formatter:function(e){return p(d(e).getMonth()+1)}},y:{name:"y",index:0,extract:function(){return"(\\d{2})"},parser:function(e){var t=void 0;if(e){var n=e.length;e=e.substring(n-2,n)}var r=h.defaultNumberParser()(e),a=new Date,i=Math.trunc(a.getFullYear()/100);return d(t=""+i+r).getFullYear()>a.getFullYear()&&(t=""+(i-1)+r),d(t).getFullYear()},formatter:function(e){var t=d(e).getFullYear().toString(),n=void 0;return t&&(n=t.length,t=t.substring(n-2,n)),t}},Y:{name:"Y",index:0,extract:function(){return"(\\d{4})"},parser:h.defaultNumberParser(),formatter:function(e){return d(e).getFullYear().toString()}}}},h.getTokenFormalNames=function(){var e=h.getTokenDefinitions();return{HOUR:e.H,HOUR_12:e.l,AMPM_UPPERCASE:e.p,AMPM_LOWERCASE:e.P,MINUTE:e.M,SECOND:e.S,SHORT_DAY:e.a,LONG_DAY:e.A,DAY_OF_MONTH:e.e,DAY_OF_MONTH_CONSTANT_WIDTH:e.d,SHORT_MONTH:e.b,LONG_MONTH:e.B,MONTH_OF_YEAR:e.m,SHORT_YEAR:e.y,LONG_YEAR:e.Y}},h.tokenResolver=function(){var e=h.getTokenDefinitions(),t=function(){for(var e=0,t=void 0,n=void 0,r=arguments.length;e<r;e++)t=arguments.length<=e?void 0:arguments[e],(arguments.length<=e?void 0:arguments[e])&&(n=t);return n?n[0].parser(n[1]):null};return{YEAR:[e.y,e.Y,t],MONTH:[e.b,e.B,e.m,t],DAY:[e.a,e.A,e.e,e.d,t],HOUR:[e.H,e.l,e.p,e.P,function(e,t,n,r){var a=void 0,i=void 0,o=void 0,u=void 0;return t&&(i=n||r)?("pm"===i[0].parser(i[1])&&(o=!0),a=t):a=t||e,a?(u=a[0].parser(a[1]),o&&(u+=12),u):null}],MINUTE:[e.M,t],SECOND:[e.S,t]}},h.findTokens=function(e){for(var t=h.TOKEN_PREFIX,n=h.getTokenDefinitions(),r=Object.keys(n),a=[],i=void 0,o=void 0;(i=e.indexOf(t,i+1))>=0;)o=e[i+1],-1!==r.indexOf(o)&&a.push({index:i,token:o});return a},h.formatAs=function(e,t){var n,r=d(e),a=h.findTokens(t),i=h.getTokenDefinitions(),o=String(t),u=h.TOKEN_PREFIX,c=void 0,f=void 0,l=void 0;for(l=0,n=a.length;l<n;l++)f=i[c=a[l].token].formatter(r),o=o.replace(new RegExp(u+c,"g"),f);return o},h.prototype.parse=function(e,t){var n=h.tokenResolver(),r=this.extractTokenValue(e),a=h.DATETIME_PARAM_SEQUENCE,i=t&&t.noBreak,o=[],u=[],c=void 0,f=void 0,l=void 0,s=void 0,d=void 0,p=void 0,v=void 0,m=void 0,y=[];for(c in n)if({}.hasOwnProperty.call(n,c)){for(u.length=0,l=(f=n[c]).splice(f.length-1,1)[0],d=0,m=f.length;d<m;d++)void 0===(s=r[(p=f[d]).name])?u.push(null):u.push([p,s]);if(null==(v=l.apply(this,u))&&!i)break;o[a[c]]=v}return o.length&&this.checkIfOnlyYear(o.length)?y.unshift(o[0],0,1):y.unshift.apply(y,o),y},h.prototype.extractTokenValue=function(e){var t,n=this.format,r=h.getTokenDefinitions(),a=h.TOKEN_PREFIX,i=h.findTokens(n),o={},u=void 0,c=void 0,f=void 0,l=void 0,s=void 0,d=void 0;s=String(n);var p=i.map(function(e){return e.token}),v=i.length;for(d=v-1;d>=0;d--)(f=i[d].index)+1!==s.length-1?(void 0===u&&(u=s.length),l=s.substring(f+2,u),s=s.substring(0,f+2)+RegExp.escape(l)+s.substring(u,s.length),u=f):u=f;for(d=0;d<v;d++)c=i[d],s=s.replace(a+c.token,r[c.token].extract());var m=e.match(new RegExp(s))||[];for(m.shift(),d=0,t=p.length;d<t;d++)o[p[d]]=m[d];return o},h.prototype.getNativeDate=function(e){var t=null;if(Number.isFinite(e))t=new Date(e);else if(!this.format&&Date.parse(e))t=new Date(e);else{var n=this.dtParams=this.parse(e);n.length&&(this.nativeDate=new(Function.prototype.bind.apply(Date,[null].concat(function(e){if(Array.isArray(e)){for(var t=0,n=Array(e.length);t<e.length;t++)n[t]=e[t];return n}return Array.from(e)}(n)))),t=this.nativeDate)}return t},h.prototype.checkIfOnlyYear=function(e){return 1===e&&this.format.match(/y|Y/g).length},h.prototype.formatAs=function(e,t){var n=void 0;return t?n=this.nativeDate=this.getNativeDate(t):(n=this.nativeDate)||(n=this.getNativeDate(t)),h.formatAs(n,e)};var v=function(e){var t=0;return function(){for(var n=arguments.length,r=Array(n),a=0;a<n;a++)r[a]=arguments[a];r.forEach(function(n,r){e[r]instanceof Array||(e[r]=Array.from({length:t})),e[r].push(n)}),t++}},m="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},y="object",g=Object.prototype.toString,b="[object Object]",w="[object Array]";function O(e,t){for(var n=t.length,r=-1;n;){if(e===t[n])return r=n;n-=1}return r}function _(e,t,n){return(void 0===e?"undefined":m(e))!==y&&(void 0===t?"undefined":m(t))!==y?null:(void 0===t?"undefined":m(t))!==y||null===t?e:((void 0===e?"undefined":m(e))!==y&&(e=t instanceof Array?[]:{}),function e(t,n,r,a,i){var o,u,c,f,l;if(i?(a.push(t),i.push(n)):(a=[t],i=[n]),n instanceof Array)for(o=0;o<n.length;o+=1){try{u=t[o],c=n[o]}catch(e){continue}(void 0===c?"undefined":m(c))!==y?r&&void 0===c||(t[o]=c):(null!==u&&(void 0===u?"undefined":m(u))===y||(u=t[o]=c instanceof Array?[]:{}),-1!==(l=O(c,i))?u=t[o]=a[l]:e(u,c,r,a,i))}else for(o in n){try{u=t[o],c=n[o]}catch(e){continue}if(null!==c&&(void 0===c?"undefined":m(c))===y)(f=g.call(c))===b?(null!==u&&(void 0===u?"undefined":m(u))===y||(u=t[o]={}),-1!==(l=O(c,i))?u=t[o]=a[l]:e(u,c,r,a,i)):f===w?(null!==u&&u instanceof Array||(u=t[o]=[]),-1!==(l=O(c,i))?u=t[o]=a[l]:e(u,c,r,a,i)):t[o]=c;else{if(r&&void 0===c)continue;t[o]=c}}return t}(e,t,n),e)}function E(e){return Array.isArray(e)}var A=function(){return"id-"+(new Date).getTime()+Math.round(1e4*Math.random())};function j(e,t){if(!E(e)||!E(t))return e===t;if(e.length!==t.length)return!1;for(var n=0;n<e.length;n++)if(e[n]!==t[n])return!1;return!0}function S(e){return e}var D=function(e){return"string"==typeof e?o.DSV_STR:E(e)&&E(e[0])?o.DSV_ARR:E(e)&&(0===e.length||function(e){return e===Object(e)}(e[0]))?o.FLAT_JSON:null},F={data:{},createNamespace:function(e,t){var n=t||A();return this.data[n]={name:n,fields:e,fieldsObj:function(){var e=this._cachedFieldsObj;return e||(e=this._cachedFieldsObj={},this.fields.forEach(function(t){e[t.name()]=t})),e},getMeasure:function(){var e=this._cachedMeasure;return e||(e=this._cachedMeasure={},this.fields.forEach(function(t){t.schema().type===f.MEASURE&&(e[t.name()]=t)})),e},getDimension:function(){var e=this._cachedDimension;return this._cachedDimension||(e=this._cachedDimension={},this.fields.forEach(function(t){t.schema().type===f.DIMENSION&&(e[t.name()]=t)})),e}},this.data[n]}},k=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();var N=function(){function e(t,n,r){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e);var a=Ht(r,t);Object.defineProperties(this,{_value:{enumerable:!1,configurable:!1,writable:!1,value:t},_formattedValue:{enumerable:!1,configurable:!1,writable:!1,value:a},_internalValue:{enumerable:!1,configurable:!1,writable:!1,value:n}}),this.field=r}return k(e,[{key:"toString",value:function(){return String(this.value)}},{key:"valueOf",value:function(){return this.value}},{key:"value",get:function(){return this._value}},{key:"formattedValue",get:function(){return this._formattedValue}},{key:"internalValue",get:function(){return this._internalValue}}]),e}();function T(e,t){e.length>0&&e.split(",").forEach(function(e){var n=e.split("-"),r=+n[0],a=+(n[1]||n[0]);if(a>=r)for(var i=r;i<=a;i+=1)t(i)})}var R=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();var C=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._value=t}return R(e,null,[{key:"invalidAwareVals",value:function(t){return t?Object.assign(e._invalidAwareValsMap,t):e._invalidAwareValsMap}}]),R(e,[{key:"value",value:function(){return this._value}},{key:"toString",value:function(){return String(this._value)}}],[{key:"isInvalid",value:function(t){return t instanceof e||!!e.invalidAwareVals()[t]}},{key:"getInvalidType",value:function(t){return t instanceof e?t:e.invalidAwareVals()[t]}}]),e}();C.NULL=new C("null"),C.NA=new C("na"),C.NIL=new C("nil"),C._invalidAwareValsMap={invalid:C.NA,nil:C.NIL,null:C.NULL,undefined:C.NA};var M=C,I=function(){return function(e,t){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return function(e,t){var n=[],r=!0,a=!1,i=void 0;try{for(var o,u=e[Symbol.iterator]();!(r=(o=u.next()).done)&&(n.push(o.value),!t||n.length!==t);r=!0);}catch(e){a=!0,i=e}finally{try{!r&&u.return&&u.return()}finally{if(a)throw i}}return n}(e,t);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),P=function(e,t,n){for(var r=[],a=t;a<n;)r.push(a),a+=e;return r.push(a),r},x=function(e,t){for(var n=0,r=e.length-1,a=void 0,i=void 0;n<=r;){if(t>=(i=e[a=n+Math.floor((r-n)/2)]).start&&t<i.end)return i;t>=i.end?n=a+1:t<i.start&&(r=a-1)}return null};var U={SELECT:"select",PROJECT:"project",GROUPBY:"group",COMPOSE:"compose",CAL_VAR:"calculatedVariable",BIN:"bin",SORT:"sort"},L={CROSS:"cross",LEFTOUTER:"leftOuter",RIGHTOUTER:"rightOuter",NATURAL:"natural",FULLOUTER:"fullOuter"},V="and";function Y(e,t){var n=[],r=[];return e.fields.forEach(function(e){r.push(e.schema().name)}),t.fields.forEach(function(e){-1!==r.indexOf(e.schema().name)&&n.push(e.schema().name)}),n}function B(){return!0}function H(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]&&arguments[3],a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:L.CROSS,i=[],o=[],u=n||B,c=e.getFieldspace(),f=t.getFieldspace(),l=c.name,s=f.name,d=c.name+"."+f.name,p=Y(c,f);if(l===s)throw new Error("DataModels must have different alias names");return c.fields.forEach(function(e){var t=_({},e.schema());-1===p.indexOf(t.name)||r||(t.name=c.name+"."+t.name),i.push(t)}),f.fields.forEach(function(e){var t=_({},e.schema());-1!==p.indexOf(t.name)?r||(t.name=f.name+"."+t.name,i.push(t)):i.push(t)}),T(e._rowDiffset,function(n){var d=!1,h=void 0;T(t._rowDiffset,function(v){var m=[],y={};y[l]={},y[s]={},c.fields.forEach(function(e){m.push(e.partialField.data[n]),y[l][e.name()]={rawValue:e.partialField.data[n],formattedValue:e.formattedData()[n]}}),f.fields.forEach(function(e){-1!==p.indexOf(e.schema().name)&&r||m.push(e.partialField.data[v]),y[s][e.name()]={rawValue:e.partialField.data[v],formattedValue:e.formattedData()[v]}});var g=_t(y[l]),b=_t(y[s]);if(u(g,b,function(){return e.detachedRoot()},function(){return t.detachedRoot()},{})){var w={};m.forEach(function(e,t){w[i[t].name]=e}),d&&L.CROSS!==a?o[h]=w:(o.push(w),d=!0,h=n)}else if((a===L.LEFTOUTER||a===L.RIGHTOUTER)&&!d){var O={},_=c.fields.length-1;m.forEach(function(e,t){O[i[t].name]=t<=_?e:null}),d=!0,h=n,o.push(O)}})}),new Xt(o,i,{name:d})}function G(e,t){var n=""+e,r=""+t;return n<r?-1:n>r?1:0}function J(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:G;return e.length>1&&function e(t,n,r,a){if(r===n)return t;var i=n+Math.floor((r-n)/2);return e(t,n,i,a),e(t,i+1,r,a),function(e,t,n,r,a){for(var i=e,o=[],u=t;u<=r;u+=1)o[u]=i[u];for(var c=t,f=n+1,l=t;l<=r;l+=1)c>n?(i[l]=o[f],f+=1):f>r?(i[l]=o[c],c+=1):a(o[c],o[f])<=0?(i[l]=o[c],c+=1):(i[l]=o[f],f+=1)}(t,n,i,r,a),t}(e,0,e.length-1,t),e}var z=function(){return function(e,t){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return function(e,t){var n=[],r=!0,a=!1,i=void 0;try{for(var o,u=e[Symbol.iterator]();!(r=(o=u.next()).done)&&(n.push(o.value),!t||n.length!==t);r=!0);}catch(e){a=!0,i=e}finally{try{!r&&u.return&&u.return()}finally{if(a)throw i}}return n}(e,t);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}();function K(e){if(Array.isArray(e)){for(var t=0,n=Array(e.length);t<e.length;t++)n[t]=e[t];return n}return Array.from(e)}function W(e,t){var n="desc"===String(t).toLowerCase()?"desc":"asc";return function(e,t){var n=void 0;switch(e){case c.CONTINUOUS:case u.TEMPORAL:n="asc"===t?function(e,t){return e-t}:function(e,t){return t-e};break;default:n="asc"===t?function(e,t){return(e=""+e)==(t=""+t)?0:e>t?1:-1}:function(e,t){return(e=""+e)==(t=""+t)?0:e>t?-1:1}}return n}(e.type,n)}function X(e,t){var n=new Map,r=[];return e.forEach(function(e){var a=e[t];n.has(a)?r[n.get(a)][1].push(e):(r.push([a,[e]]),n.set(a,r.length-1))}),r}function q(e,t,n){var r={label:e[0]};return t.reduce(function(t,r,a){return t[r]=e[1].map(function(e){return e[n[a].index]}),t},r),r}function Z(e,t,n){for(var r=void 0,a=void 0,i=void 0,o=n.length-1;o>=0;o--)r=n[o][0],a=n[o][1],(i=xt(t,r))&&("function"==typeof a?J(e,function(e,t){return a(e[i.index],t[i.index])}):E(a)?function(){var n=X(e,i.index),r=a[a.length-1],o=a.slice(0,a.length-1),u=o.map(function(e){return xt(t,e)});n.forEach(function(e){e.push(q(e,o,u))}),J(n,function(e,t){var n=e[2],a=t[2];return r(n,a)}),e.length=0,n.forEach(function(t){e.push.apply(e,K(t[1]))})}():function(){var t=W(i,a);J(e,function(e,n){return t(e[i.index],n[i.index])})}())}var $,Q=function e(t,n,r,a){if(0===t.length)return n;var i=t[0],o=new Map;n.reduce(function(e,t){var n=t[i.index];return e.has(n)?e.get(n).push(t):e.set(n,[t]),e},o);var u=!0,c=!1,f=void 0;try{for(var l,s=o[Symbol.iterator]();!(u=(l=s.next()).done);u=!0){var d=l.value,p=z(d,2),h=p[0],v=p[1],m=e(t.slice(1),v,r,a);o.set(h,m),Array.isArray(m)&&Z(m,r,a)}}catch(e){c=!0,f=e}finally{try{!u&&s.return&&s.return()}finally{if(c)throw f}}return o};function ee(e,t){var n=e.schema,r=e.data;if(0!==(t=t.filter(function(e){return!!xt(n,e[0])})).length){var a=t.findIndex(function(e){return null===e[1]});a=-1!==a?a:t.length;var i=t.slice(0,a),o=t.slice(a);Z(r,n,i),r=function(e,t,n,r){if(0===(n=n.filter(function(e){return null!==e[1]||(r.push(e[0]),!1)})).length)return e;r=r.map(function(e){return xt(t,e)});var a=Q(r,e,t,n);return e.map(function(e){for(var t=0,n=a;!Array.isArray(n);)n=n.get(e[r[t++].index]);return n.shift()})}(r,n,o,i.map(function(e){return e[0]})),e.uids=r.map(function(e){return e.pop()}),e.data=r}}function te(e,t,n,r,a){a=Object.assign({},{addUid:!1,columnWise:!1},a);var i={schema:[],data:[],uids:[]},o=a.addUid,u=r&&r.length>0,c=[];if(n.split(",").forEach(function(t){for(var n=0;n<e.length;n+=1)if(e[n].name()===t){c.push(e[n]);break}}),c.forEach(function(e){i.schema.push(e.schema())}),o&&i.schema.push({name:"uid",type:"identifier"}),T(t,function(e){i.data.push([]);var t=i.data.length-1;c.forEach(function(n,r){i.data[t][r+0]=n.partialField.data[e]}),o&&(i.data[t][c.length]=e),i.uids.push(e),u&&i.data[t].push(e)}),u&&ee(i,r),a.columnWise){var f=Array.apply(void 0,function(e){if(Array.isArray(e)){for(var t=0,n=Array(e.length);t<e.length;t++)n[t]=e[t];return n}return Array.from(e)}(Array(i.schema.length))).map(function(){return[]});i.data.forEach(function(e){e.forEach(function(e,t){f[t].push(e)})}),i.data=f}return i}function ne(e,t){var n={},r=[],a=[],i=[],o=e.getFieldspace(),u=t.getFieldspace(),c=o.fieldsObj(),f=u.fieldsObj(),l=o.name+" union "+u.name;if(!j(e._colIdentifier.split(",").sort(),t._colIdentifier.split(",").sort()))return null;function s(e,t,r){T(e._rowDiffset,function(e){var o={},u="";a.forEach(function(n){var r=t[n].partialField.data[e];u+="-"+r,o[n]=r}),n[u]||(r&&i.push(o),n[u]=!0)})}return e._colIdentifier.split(",").forEach(function(e){var t=c[e];r.push(_({},t.schema())),a.push(t.schema().name)}),s(t,f,!1),s(e,c,!0),new Xt(i,r,{name:l})}function re(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function ae(e){if(Array.isArray(e)){for(var t=0,n=Array(e.length);t<e.length;t++)n[t]=e[t];return n}return Array.from(e)}var ie=s.SUM,oe=s.AVG,ue=s.FIRST,ce=s.LAST,fe=s.COUNT,le=s.STD,se=s.MIN,de=s.MAX;function pe(e){return e.filter(function(e){return!(e instanceof M)})}function he(e){if(E(e)&&!(e[0]instanceof Array)){var t=pe(e);return t.length?t.reduce(function(e,t){return e+t},0):M.NULL}return M.NULL}function ve(e){if(E(e)&&!(e[0]instanceof Array)){var t=he(e),n=e.length||1;return Number.isNaN(t)||t instanceof M?M.NULL:t/n}return M.NULL}var me=(re($={},ie,he),re($,oe,ve),re($,se,function(e){if(E(e)&&!(e[0]instanceof Array)){var t=pe(e);return t.length?Math.min.apply(Math,ae(t)):M.NULL}return M.NULL}),re($,de,function(e){if(E(e)&&!(e[0]instanceof Array)){var t=pe(e);return t.length?Math.max.apply(Math,ae(t)):M.NULL}return M.NULL}),re($,ue,function(e){return e[0]}),re($,ce,function(e){return e[e.length-1]}),re($,fe,function(e){return E(e)?e.length:M.NULL}),re($,le,function(e){return Math.sqrt(function(e){var t=ve(e);return ve(e.map(function(e){return Math.pow(e-t,2)}))}(e))}),$),ye=ie,ge=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();var be=function(){function e(){var t=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.store=new Map,this.store.set("defReducer",he),Object.entries(me).forEach(function(e){t.store.set(e[0],e[1])})}return ge(e,[{key:"defaultReducer",value:function(){if(!arguments.length)return this.store.get("defReducer");var e=arguments.length<=0?void 0:arguments[0];if("function"==typeof e)this.store.set("defReducer",e);else{if(e=String(e),-1===Object.keys(me).indexOf(e))throw new Error("Reducer "+e+" not found in registry");this.store.set("defReducer",me[e])}return this}},{key:"register",value:function(e,t){var n=this;if("function"!=typeof t)throw new Error("Reducer should be a function");return e=String(e),this.store.set(e,t),function(){n.__unregister(e)}}},{key:"__unregister",value:function(e){this.store.has(e)&&this.store.delete(e)}},{key:"resolve",value:function(e){return e instanceof Function?e:this.store.get(e)}}]),e}(),we=function(){var e=null;return null===e&&(e=new be),e}(),Oe=function(){return function(e,t){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return function(e,t){var n=[],r=!0,a=!1,i=void 0;try{for(var o,u=e[Symbol.iterator]();!(r=(o=u.next()).done)&&(n.push(o.value),!t||n.length!==t);r=!0);}catch(e){a=!0,i=e}finally{try{!r&&u.return&&u.return()}finally{if(a)throw i}}return n}(e,t);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}();function _e(e,t,n,r){var a=function(e,t){var n=[],r=e.getFieldspace().getDimension();return Object.entries(r).forEach(function(e){var r=Oe(e,1)[0];t&&t.length?-1!==t.indexOf(r)&&n.push(r):n.push(r)}),n}(e,t),i=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n={},r=e.getFieldspace().getMeasure(),a=we.defaultReducer();return Object.keys(r).forEach(function(e){"string"!=typeof t[e]&&(t[e]=r[e].defAggFn());var i=we.resolve(t[e]);i?n[e]=i:(n[e]=a,t[e]=ye)}),n}(e,n),o=e.getFieldspace(),u=o.fieldsObj(),c=o.name,l=[],s=[],d=[],p={},h=[],v=void 0;Object.entries(u).forEach(function(e){var t=Oe(e,2),n=t[0],r=t[1];if(-1!==a.indexOf(n)||i[n])switch(d.push(_({},r.schema())),r.schema().type){case f.MEASURE:s.push(n);break;default:case f.DIMENSION:l.push(n)}});var m=0;T(e._rowDiffset,function(e){var t="";l.forEach(function(n){t=t+"-"+u[n].partialField.data[e]}),void 0===p[t]?(p[t]=m,h.push({}),l.forEach(function(t){h[m][t]=u[t].partialField.data[e]}),s.forEach(function(t){h[m][t]=[u[t].partialField.data[e]]}),m+=1):s.forEach(function(n){h[p[t]][n].push(u[n].partialField.data[e])})});var y={},g=function(){return e.detachedRoot()};return h.forEach(function(e){var t=e;s.forEach(function(n){t[n]=i[n](e[n],g,y)})}),r?(r.__calculateFieldspace(),v=r):v=new un(h,d,{name:c}),v}function Ee(e,t){var n=Y(e.getFieldspace(),t.getFieldspace());return function(e,t){var r=!0;return n.forEach(function(n){r=!(e[n].internalValue!==t[n].internalValue||!r)}),r}}function Ae(e,t){var n={},r=[],a=[],i=[],o=e.getFieldspace(),u=t.getFieldspace(),c=o.fieldsObj(),f=u.fieldsObj(),l=o.name+" union "+u.name;if(!j(e._colIdentifier.split(",").sort(),t._colIdentifier.split(",").sort()))return null;function s(e,t){T(e._rowDiffset,function(e){var r={},o="";a.forEach(function(n){var a=t[n].partialField.data[e];o+="-"+a,r[n]=a}),n[o]||(i.push(r),n[o]=!0)})}return e._colIdentifier.split(",").forEach(function(e){var t=c[e];r.push(_({},t.schema())),a.push(t.schema().name)}),s(e,c),s(t,f),new un(i,r,{name:l})}function je(e,t,n){return H(e,t,n,!1,L.LEFTOUTER)}function Se(e,t,n){return H(t,e,n,!1,L.RIGHTOUTER)}var De=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();var Fe=function(){function e(t,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.partialField=t,this.rowDiffset=n}return De(e,[{key:"domain",value:function(){throw new Error("Not yet implemented")}},{key:"schema",value:function(){return this.partialField.schema}},{key:"name",value:function(){return this.partialField.name}},{key:"type",value:function(){return this.partialField.schema.type}},{key:"subtype",value:function(){return this.partialField.schema.subtype}},{key:"description",value:function(){return this.partialField.schema.description}},{key:"displayName",value:function(){return this.partialField.schema.displayName||this.partialField.schema.name}},{key:"data",value:function(){var e=this,t=[];return T(this.rowDiffset,function(n){t.push(e.partialField.data[n])}),t}},{key:"formattedData",value:function(){throw new Error("Not yet implemented")}}]),e}(),ke=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();var Ne=function(e){function t(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,Fe),ke(t,[{key:"domain",value:function(){return this._cachedDomain||(this._cachedDomain=this.calculateDataDomain()),this._cachedDomain}},{key:"calculateDataDomain",value:function(){throw new Error("Not yet implemented")}},{key:"formattedData",value:function(){return this.data()}}]),t}(),Te=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();var Re=function(e){function t(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,Ne),Te(t,[{key:"subtype",value:function(){return u.CATEGORICAL}},{key:"calculateDataDomain",value:function(){var e=this,t=new Set,n=[];return T(this.rowDiffset,function(r){var a=e.partialField.data[r];t.has(a)||(t.add(a),n.push(a))}),n}}]),t}(),Ce=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();var Me=function(e){function t(e,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var r=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,n));return r._cachedMinDiff=null,r}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,Ne),Ce(t,[{key:"calculateDataDomain",value:function(){var e=this,t=new Set,n=[];return T(this.rowDiffset,function(r){var a=e.partialField.data[r];t.has(a)||(t.add(a),n.push(a))}),n}},{key:"minimumConsecutiveDifference",value:function(){if(this._cachedMinDiff)return this._cachedMinDiff;for(var e=this.data().filter(function(e){return!(e instanceof M)}).sort(function(e,t){return e-t}),t=e.length,n=Number.POSITIVE_INFINITY,r=void 0,a=void 0,i=0,o=1;o<t;o++)r=e[o-1],(a=e[o])!==r&&(n=Math.min(n,a-e[o-1]),i++);return i||(n=null),this._cachedMinDiff=n,this._cachedMinDiff}},{key:"format",value:function(){return this.partialField.schema.format}},{key:"formattedData",value:function(){var e=this,t=[];return T(this.rowDiffset,function(n){var r=e.partialField.data[n];r instanceof M?t.push(r):t.push(h.formatAs(r,e.format()))}),t}}]),t}(),Ie=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();var Pe=function(e){function t(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,Ne),Ie(t,[{key:"calculateDataDomain",value:function(){var e=this.partialField.schema.bins;return[e[0],e[e.length-1]]}},{key:"bins",value:function(){return this.partialField.schema.bins}}]),t}(),xe=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();var Ue=function(e){function t(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,Fe),xe(t,[{key:"domain",value:function(){return this._cachedDomain||(this._cachedDomain=this.calculateDataDomain()),this._cachedDomain}},{key:"unit",value:function(){return this.partialField.schema.unit}},{key:"defAggFn",value:function(){return this.partialField.schema.defAggFn||ye}},{key:"numberFormat",value:function(){var e=this.partialField.schema.numberFormat;return e instanceof Function?e:S}},{key:"calculateDataDomain",value:function(){throw new Error("Not yet implemented")}},{key:"formattedData",value:function(){return this.data()}}]),t}(),Le=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();var Ve=function(e){function t(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,Ue),Le(t,[{key:"subtype",value:function(){return c.CONTINUOUS}},{key:"calculateDataDomain",value:function(){var e=this,t=Number.POSITIVE_INFINITY,n=Number.NEGATIVE_INFINITY;return T(this.rowDiffset,function(r){var a=e.partialField.data[r];a instanceof M||(a<t&&(t=a),a>n&&(n=a))}),[t,n]}}]),t}(),Ye=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();var Be=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}return Ye(e,[{key:"parse",value:function(){throw new Error("Not yet implemented")}}]),e}(),He=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();var Ge=function(e){function t(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,Be),He(t,[{key:"parse",value:function(e){return M.isInvalid(e)?M.getInvalidType(e):String(e).trim()}}]),t}(),Je=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();var ze=function(e){function t(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var n=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return n.schema=e,n._dtf=new h(n.schema.format),n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,Be),Je(t,[{key:"parse",value:function(e){var t=void 0;if(M.isInvalid(e))t=M.getInvalidType(e);else{var n=this._dtf.getNativeDate(e);t=n?n.getTime():M.NA}return t}}]),t}(),Ke=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();var We=function(e){function t(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,Be),Ke(t,[{key:"parse",value:function(e){e=String(e);var t=void 0;if(M.isInvalid(e))t=M.getInvalidType(e);else{var n=e.match(/^\s*([+-]?\d+(?:\.\d+)?)\s*-\s*([+-]?\d+(?:\.\d+)?)\s*$/);t=n?Number.parseFloat(n[1])+"-"+Number.parseFloat(n[2]):M.NA}return t}}]),t}(),Xe=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();var qe=function(e){function t(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,Be),Xe(t,[{key:"parse",value:function(e){var t=void 0;if(M.isInvalid(e))t=M.getInvalidType(e);else{var n=parseFloat(e,10);t=Number.isNaN(n)?M.NA:n}return t}}]),t}(),Ze=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();var $e=function(){function e(t,n,r,a){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.name=t,this.schema=r,this.parser=a,this.data=this._sanitize(n)}return Ze(e,[{key:"_sanitize",value:function(e){var t=this;return e.map(function(e){return t.parser.parse(e)})}}]),e}();function Qe(e,t,n){var r={};return n&&n.length||(n=t.map(function(e){return e.name})),n.forEach(function(e,t){r[e]=t}),t.map(function(t){return function(e,t){e=e||[];var n=void 0;switch(t.type){case f.MEASURE:switch(t.subtype){case c.CONTINUOUS:default:return n=new $e(t.name,e,t,new qe),new Ve(n,"0-"+(e.length-1))}case f.DIMENSION:switch(t.subtype){case u.CATEGORICAL:return n=new $e(t.name,e,t,new Ge),new Re(n,"0-"+(e.length-1));case u.TEMPORAL:return n=new $e(t.name,e,t,new ze(t)),new Me(n,"0-"+(e.length-1));case u.BINNED:return n=new $e(t.name,e,t,new We),new Pe(n,"0-"+(e.length-1));default:return n=new $e(t.name,e,t,new Ge),new Re(n,"0-"+(e.length-1))}default:return n=new $e(t.name,e,t,new Ge),new Re(n,"0-"+(e.length-1))}}(e[r[t.name]],t)})}var et={dataFormat:o.AUTO};var tt=function(e,t){t=Object.assign({},{firstRowHeader:!0},t);var n=void 0,r=[],a=v(r);return n=t.firstRowHeader?e.splice(0,1)[0]:[],e.forEach(function(e){return a.apply(void 0,function(e){if(Array.isArray(e)){for(var t=0,n=Array(e.length);t<e.length;t++)n[t]=e[t];return n}return Array.from(e)}(e))}),[n,r]},nt={},rt={},at=34,it=10,ot=13;function ut(e){return new Function("d","return {"+e.map(function(e,t){return JSON.stringify(e)+": d["+t+"]"}).join(",")+"}")}function ct(e){var t=Object.create(null),n=[];return e.forEach(function(e){for(var r in e)r in t||n.push(t[r]=r)}),n}function ft(e,t){var n=e+"",r=n.length;return r<t?new Array(t-r+1).join(0)+n:n}function lt(e){var t,n=e.getUTCHours(),r=e.getUTCMinutes(),a=e.getUTCSeconds(),i=e.getUTCMilliseconds();return isNaN(e)?"Invalid Date":((t=e.getUTCFullYear())<0?"-"+ft(-t,6):t>9999?"+"+ft(t,6):ft(t,4))+"-"+ft(e.getUTCMonth()+1,2)+"-"+ft(e.getUTCDate(),2)+(i?"T"+ft(n,2)+":"+ft(r,2)+":"+ft(a,2)+"."+ft(i,3)+"Z":a?"T"+ft(n,2)+":"+ft(r,2)+":"+ft(a,2)+"Z":r||n?"T"+ft(n,2)+":"+ft(r,2)+"Z":"")}var st=function(e){var t=new RegExp('["'+e+"\n\r]"),n=e.charCodeAt(0);function r(e,t){var r,a=[],i=e.length,o=0,u=0,c=i<=0,f=!1;function l(){if(c)return rt;if(f)return f=!1,nt;var t,r,a=o;if(e.charCodeAt(a)===at){for(;o++<i&&e.charCodeAt(o)!==at||e.charCodeAt(++o)===at;);return(t=o)>=i?c=!0:(r=e.charCodeAt(o++))===it?f=!0:r===ot&&(f=!0,e.charCodeAt(o)===it&&++o),e.slice(a+1,t-1).replace(/""/g,'"')}for(;o<i;){if((r=e.charCodeAt(t=o++))===it)f=!0;else if(r===ot)f=!0,e.charCodeAt(o)===it&&++o;else if(r!==n)continue;return e.slice(a,t)}return c=!0,e.slice(a,i)}for(e.charCodeAt(i-1)===it&&--i,e.charCodeAt(i-1)===ot&&--i;(r=l())!==rt;){for(var s=[];r!==nt&&r!==rt;)s.push(r),r=l();t&&null==(s=t(s,u++))||a.push(s)}return a}function a(t,n){return t.map(function(t){return n.map(function(e){return o(t[e])}).join(e)})}function i(t){return t.map(o).join(e)}function o(e){return null==e?"":e instanceof Date?lt(e):t.test(e+="")?'"'+e.replace(/"/g,'""')+'"':e}return{parse:function(e,t){var n,a,i=r(e,function(e,r){if(n)return n(e,r-1);a=e,n=t?function(e,t){var n=ut(e);return function(r,a){return t(n(r),a,e)}}(e,t):ut(e)});return i.columns=a||[],i},parseRows:r,format:function(t,n){return null==n&&(n=ct(t)),[n.map(o).join(e)].concat(a(t,n)).join("\n")},formatBody:function(e,t){return null==t&&(t=ct(e)),a(e,t).join("\n")},formatRows:function(e){return e.map(i).join("\n")}}},dt=st(","),pt=(dt.parse,dt.parseRows,dt.format,dt.formatBody,dt.formatRows,st("\t"));pt.parse,pt.parseRows,pt.format,pt.formatBody,pt.formatRows;var ht=function(e,t){t=Object.assign({},{firstRowHeader:!0,fieldSeparator:","},t);var n=st(t.fieldSeparator);return tt(n.parseRows(e),t)};var vt=function(e){var t={},n=0,r=void 0,a=[],i=v(a);return e.forEach(function(e){var a=[];for(var o in e)o in t?r=t[o]:(t[o]=n++,r=n-1),a[r]=e[o];i.apply(void 0,a)}),[Object.keys(t),a]};var mt,yt=function(e,t){var n={FlatJSON:vt,DSVStr:ht,DSVArr:tt},r=D(e);if(!r)throw new Error("Couldn't detect the data format");return n[r](e,t)},gt=function(){return function(e,t){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return function(e,t){var n=[],r=!0,a=!1,i=void 0;try{for(var o,u=e[Symbol.iterator]();!(r=(o=u.next()).done)&&(n.push(o.value),!t||n.length!==t);r=!0);}catch(e){a=!0,i=e}finally{try{!r&&u.return&&u.return()}finally{if(a)throw i}}return n}(e,t);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}();function bt(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function wt(e){if(Array.isArray(e)){for(var t=0,n=Array(e.length);t<e.length;t++)n[t]=e[t];return n}return Array.from(e)}function Ot(e,t,n,r){var a={},i=!0,o=!1,u=void 0;try{for(var c,f=e.entries()[Symbol.iterator]();!(i=(c=f.next()).done);i=!0){var l=c.value,s=gt(l,2),d=s[0],p=s[1];a[p.name()]=new N(t[d][r],n[d][r],p)}}catch(e){o=!0,u=e}finally{try{!i&&f.return&&f.return()}finally{if(o)throw u}}return a}function _t(e){var t={};for(var n in e)t[n]=new N(e[n].formattedValue,e[n].rawValue,n);return t}var Et=function(e,t,n){var r=gt(e,2),a=r[0],i=r[1],o=i.length?i.split(","):[],l=t.fieldsObj(),s=o.map(function(e){return function(e,t){var n=e.schema;switch(n.type){case f.MEASURE:switch(n.subtype){case c.CONTINUOUS:default:return new Ve(e,t)}case f.DIMENSION:switch(n.subtype){case u.CATEGORICAL:return new Re(e,t);case u.TEMPORAL:return new Me(e,t);case u.BINNED:return new Pe(e,t);default:return new Re(e,t)}default:return new Re(e,t)}}(l[e].partialField,a)});return F.createNamespace(s,n)},At=function(e,t,n){!function(e,t){var n,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},a=arguments[3];t===U.COMPOSE?(e._derivation.length=0,(n=e._derivation).push.apply(n,wt(a))):e._derivation.push({op:t,meta:r,criteria:a})}(t,n,arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},arguments[4]),function(e,t){var n;(n=t._ancestorDerivation).push.apply(n,wt(e._ancestorDerivation).concat(wt(e._derivation)))}(e,t)},jt=(bt(mt={},l.NORMAL,{diffIndex:["rowDiffset"],calcDiff:[!0,!1]}),bt(mt,l.INVERSE,{diffIndex:["rejectRowDiffset"],calcDiff:[!1,!0]}),bt(mt,l.ALL,{diffIndex:["rowDiffset","rejectRowDiffset"],calcDiff:[!0,!0]}),mt),St=function(e,t,n){if(-1!==n&&t===n+1){var r=e.length-1;e[r]=e[r].split("-")[0]+"-"+t}else e.push(""+t)},Dt=function(e,t,n){var r=[],a=[],i=gt(jt[n].calcDiff,2),o=i[0],u=i[1];return T(e,function(e){var n=t(e);n&&o&&St(r,e,-1),!n&&u&&St(a,e,-1)}),{rowDiffset:r.join(","),rejectRowDiffset:a.join(",")}},Ft=function(e,t,n,r,a){var i={},o=function(){return r.detachedRoot()},u=n.mode,c=e._rowDiffset,f=e.getPartialFieldspace().fields,l=f.map(function(e){return e.formattedData()}),s=f.map(function(e){return e.data()});return a(c,function(e){return t(Ot(f,l,s,e),e,o,i)},u)},kt=function(e,t,n){for(var r=n(e,t,0),a=1,i=e.length;a<i;a++)r=r+","+n(e,t,a);return r},Nt=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=[],a=n.operation||V,i=n.filterByMeasure||!1,o=function(e){var t=e.clone(!1),n=e.getPartialFieldspace();return t._colIdentifier=n.fields.map(function(e){return e.name()}).join(","),n._cachedFieldsObj=null,n._cachedDimension=null,n._cachedMeasure=null,t.__calculateFieldspace().calculateFieldsConfig(),t}(e),u=o.getFieldsConfig();r=t.length?t.map(function(e){return n=void 0,r=(t=e).getData(),a=t.getFieldsConfig(),o=Object.keys(t.getFieldspace().getDimension()).filter(function(e){return e in u}),c=o.length,f=o.map(function(e){return a[e].index}),l=Object.keys(t.getFieldspace().getMeasure()).filter(function(e){return e in u}),s=t.getFieldspace().fieldsObj(),d=r.data,p=l.reduce(function(e,t){return e[t]=s[t].domain(),e},{}),h={},n=function(e,t,n){return t[e[n]]},c&&d.forEach(function(e){var t=kt(f,e,n);h[t]=1}),n=function(e,t,n){return t[e[n]].internalValue},d.length?function(e){var t=!c||h[kt(o,e,n)];return i?l.every(function(t){return e[t].internalValue>=p[t][0]&&e[t].internalValue<=p[t][1]})&&t:t}:function(){return!1};var t,n,r,a,o,c,f,l,s,d,p,h}):[function(){return!1}];return a===V?o.select(function(e){return r.every(function(t){return t(e)})},{saveChild:!1}):o.select(function(e){return r.some(function(t){return t(e)})},{saveChild:!1})},Tt=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:function(e){return e},r=arguments[3],a=r.saveChild,i=e.getFieldspace().fieldsObj(),o=Ft(e.clone(a),n,r,e,function(){for(var e=arguments.length,n=Array(e),r=0;r<e;r++)n[r]=arguments[r];return function(e,t,n,r,a){var i={},o={},u={};return T(e,function(e){if(t(e)){var n="",c={keys:{}};r.forEach(function(t){var r=a[t].partialField.data[e];n=n+"-"+r,c.keys[t]=r}),void 0===o[n]&&(o[n]=[],i[n]=-1,u[n]=c),St(o[n],e,i[n]),i[n]=e}}),{splitRowDiffset:o,dimensionMap:u}}.apply(void 0,n.concat([t,i]))}),u=o.splitRowDiffset,c=o.dimensionMap,f=[];return Object.keys(u).forEach(function(n){if(u[n]){var i=e.clone(a),o=c[n];i._rowDiffset=u[n].join(","),i.__calculateFieldspace().calculateFieldsConfig();a&&At(e,i,U.SELECT,r,function(e){return t.every(function(t){return e[t].internalValue===o.keys[t]})}),i._derivation[i._derivation.length-1].meta=c[n],f.push(i)}}),f},Rt=function(e,t,n,r,a){e._rowDiffset=t,e.__calculateFieldspace().calculateFieldsConfig(),At(n,e,U.SELECT,{config:r},a)},Ct=function(e,t,n,r){var a=e.clone(n.saveChild),i=t;return n.mode===l.INVERSE&&(i=r.filter(function(e){return-1===t.indexOf(e)})),a._colIdentifier=i.join(","),a.__calculateFieldspace().calculateFieldsConfig(),At(e,a,U.PROJECT,{projField:t,config:n,actualProjField:i},null),a},Mt=function(e){if((e=_({},e)).type||(e.type=f.DIMENSION),!e.subtype)switch(e.type){case f.MEASURE:e.subtype=c.CONTINUOUS;break;default:case f.DIMENSION:e.subtype=u.CATEGORICAL}return e},It=function(e){return e.map(function(e){return function(e){var t=[c.CONTINUOUS],n=[u.CATEGORICAL,u.BINNED,u.TEMPORAL,u.GEO],r=e.type,a=e.subtype,i=e.name;switch(r){case f.DIMENSION:if(-1===n.indexOf(a))throw new Error("DataModel doesn't support dimension field subtype "+a+" used for "+i+" field");break;case f.MEASURE:if(-1===t.indexOf(a))throw new Error("DataModel doesn't support measure field subtype "+a+" used for "+i+" field");break;default:throw new Error("DataModel doesn't support field type "+r+" used for "+i+" field")}}(e=Mt(e)),e})},Pt=function(e,t,n,r){n=It(n),r=Object.assign(Object.assign({},et),r);var i=a[r.dataFormat];if(!i||"function"!=typeof i)throw new Error("No converter function found for "+r.dataFormat+" format");var u=i(t,r),c=gt(u,2),f=c[0],l=c[1];!function(e,t){e.forEach(function(e){var n=e.as;if(n){var r=t.indexOf(e.name);t[r]=n,e.name=n,delete e.as}})}(n,f);var s=Qe(l,n,f),d=F.createNamespace(s,r.name);e._partialFieldspace=d,e._rowDiffset=l.length&&l[0].length?"0-"+(l[0].length-1):"";var p=[],h=d.fields,v=h.map(function(e){return e.data()}),m=h.map(function(e){return e.formattedData()});return T(e._rowDiffset,function(e){p[e]=Ot(h,m,v,e)}),d._cachedValueObjects=p,e._colIdentifier=n.map(function(e){return e.name}).join(),e._dataFormat=r.dataFormat===o.AUTO?D(t):r.dataFormat,e},xt=function(e,t){for(var n=0;n<e.length;++n)if(t===e[n].name)return{name:t,type:e[n].subtype||e[n].type,index:n};return null},Ut=function(e,t){var n=t.getDerivations(),r=e;return n.forEach(function(e){if(e){var t,n=function(e){var t=[],n=void 0;switch(n=e.op){case U.SELECT:t=[e.criteria];break;case U.PROJECT:t=[e.meta.actualProjField];break;case U.GROUPBY:n="groupBy",t=[e.meta.groupByString.split(","),e.criteria];break;default:n=null}return{operation:n,params:t}}(e),a=n.operation,i=n.params;if(a)r=(t=r)[a].apply(t,wt(i).concat([{saveChild:!1}]))}}),r},Lt=function e(t,n){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},i=a.nonTraversingModel,o=a.excludeModels||[];t!==i&&((!o.length||-1===o.indexOf(t))&&t.handlePropagation(n,r),t._children.forEach(function(t){var i=Ut(n,t);e(t,i,r,a)}))},Vt=function(e){for(var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];e._parent;)t.push(e),e=e._parent;return t},Yt=function(e,t,n,r){var a=void 0,i=void 0,o=n.propagationNameSpace,u=n.propagateToSource,c=n.sourceId,f=r.propagateInterpolatedValues,l=[];if(null===e&&!0!==r.persistent)l=[{criteria:[]}],a=[];else{var s,d=Object.values(o.mutableActions);!1!==u&&(d=d.filter(function(e){return e.config.sourceId!==c}));var p=d.filter(function(e){return(r.filterFn||function(){return!0})(e,r)}).map(function(e){return e.config.criteria}),h=[];if(!1!==u){var v=Object.values(o.mutableActions);v.forEach(function(e){var t=e.config;!1===t.applyOnSource&&t.action===r.action&&t.sourceId!==c&&(h.push(e.model),(a=v.filter(function(t){return t!==e}).map(function(e){return e.config.criteria})).length&&l.push({criteria:a,models:e.model,path:Vt(e.model)}))})}a=(s=[]).concat.apply(s,[].concat(wt(p),[e])).filter(function(e){return null!==e}),l.push({criteria:a,excludeModels:[].concat(h,wt(r.excludeModels||[]))})}var m=t.model,y=Object.assign({sourceIdentifiers:e,propagationSourceId:c},r),g=t.groupByModel;f&&g&&(i=Nt(g,a,{filterByMeasure:f}),Lt(g,i,y)),l.forEach(function(e){var t=Nt(m,e.criteria),n=e.path;if(n){var r=function(e,t){for(var n=0,r=t.length;n<r;n++){var a=t[n];e=Ut(e,a)}return e}(t,n.reverse());e.models.handlePropagation(r,y)}else Lt(m,t,y,{excludeModels:e.excludeModels,nonTraversingModel:f&&g})})},Bt=function(e,t,n){var r=e.reduce(function(e,r){return"RegExp"===r.constructor.name?e.push.apply(e,wt(t.filter(function(e){return-1!==e.search(r)}))):r in n&&e.push(r),e},[]);return Array.from(new Set(r)).map(function(e){return e.trim()})},Ht=function(e,t){return e.numberFormat?e.numberFormat()(t):t},Gt=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();var Jt=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e);var t=void 0;this._parent=null,this._derivation=[],this._ancestorDerivation=[],this._children=[];for(var n=arguments.length,r=Array(n),a=0;a<n;a++)r[a]=arguments[a];1===r.length&&(t=r[0])instanceof e?(this._colIdentifier=t._colIdentifier,this._rowDiffset=t._rowDiffset,this._dataFormat=t._dataFormat,this._parent=t,this._partialFieldspace=this._parent._partialFieldspace,this._fieldStoreName=A(),this.__calculateFieldspace().calculateFieldsConfig()):(Pt.apply(void 0,[this].concat(r)),this._fieldStoreName=this._partialFieldspace.name,this.__calculateFieldspace().calculateFieldsConfig(),this._propagationNameSpace={mutableActions:{},immutableActions:{}})}return Gt(e,[{key:"getSchema",value:function(){return this.getFieldspace().fields.map(function(e){return e.schema()})}},{key:"getName",value:function(){return this._fieldStoreName}},{key:"getFieldspace",value:function(){return this._fieldspace}},{key:"__calculateFieldspace",value:function(){return this._fieldspace=Et([this._rowDiffset,this._colIdentifier],this.getPartialFieldspace(),this._fieldStoreName),this}},{key:"getPartialFieldspace",value:function(){return this._partialFieldspace}},{key:"join",value:function(e,t){return H(this,e,t)}},{key:"naturalJoin",value:function(e){return H(this,e,Ee(this,e),!0)}},{key:"union",value:function(e){return Ae(this,e)}},{key:"difference",value:function(e){return ne(this,e)}},{key:"select",value:function(e,t){var n={mode:l.NORMAL,saveChild:!0};return(t=Object.assign({},n,t)).mode=t.mode||n.mode,function(e,t,n,r){var a={},i=n.mode,o=e.clone(r.saveChild),u=Ft(o,t,n,e,Dt),c=jt[i].diffIndex;return Rt(o,u[c[0]],e,n,t),c.length>1?(a=e.clone(r.saveChild),Rt(a,u[c[1]],e,n,t),[o,a]):o}(this,e,t,{saveChild:t.saveChild})}},{key:"isEmpty",value:function(){return!this._rowDiffset.length||!this._colIdentifier.length}},{key:"clone",value:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],t=new this.constructor(this);return e?t.setParent(this):t.setParent(null),t}},{key:"project",value:function(e,t){var n={mode:l.NORMAL,saveChild:!0};t=Object.assign({},n,t);var r=this.getFieldsConfig(),a=Object.keys(r),i=t.mode,o=Bt(e,a,r),u=void 0;i===l.ALL?u=[Ct(this,o,{mode:l.NORMAL,saveChild:t.saveChild},a),Ct(this,o,{mode:l.INVERSE,saveChild:t.saveChild},a)]:u=Ct(this,o,t,a);return u}},{key:"getFieldsConfig",value:function(){return this._fieldConfig}},{key:"calculateFieldsConfig",value:function(){return this._fieldConfig=this._fieldspace.fields.reduce(function(e,t,n){return e[t.name()]={index:n,def:t.schema()},e},{}),this}},{key:"dispose",value:function(){this._parent&&this._parent.removeChild(this),this._parent=null,this._children.forEach(function(e){e._parent=null}),this._children=[]}},{key:"removeChild",value:function(e){var t=this._children.findIndex(function(t){return t===e});-1===t||this._children.splice(t,1)}},{key:"setParent",value:function(e){this._parent&&this._parent.removeChild(this),this._parent=e,e&&e._children.push(this)}},{key:"getParent",value:function(){return this._parent}},{key:"getChildren",value:function(){return this._children}},{key:"getDerivations",value:function(){return this._derivation}},{key:"getAncestorDerivations",value:function(){return this._ancestorDerivation}}]),e}(),zt=function(){return function(e,t){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return function(e,t){var n=[],r=!0,a=!1,i=void 0;try{for(var o,u=e[Symbol.iterator]();!(r=(o=u.next()).done)&&(n.push(o.value),!t||n.length!==t);r=!0);}catch(e){a=!0,i=e}finally{try{!r&&u.return&&u.return()}finally{if(a)throw i}}return n}(e,t);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),Kt=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();function Wt(e){if(Array.isArray(e)){for(var t=0,n=Array(e.length);t<e.length;t++)n[t]=e[t];return n}return Array.from(e)}var Xt=function(e){function t(){var e;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);for(var n=arguments.length,r=Array(n),a=0;a<n;a++)r[a]=arguments[a];var i=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(e=t.__proto__||Object.getPrototypeOf(t)).call.apply(e,[this].concat(r)));return i._onPropagation=[],i}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,Jt),Kt(t,[{key:"getData",value:function(e){e=Object.assign({},{order:"row",formatter:null,withUid:!1,getAllFields:!1,sort:[]},e);var t=this.getPartialFieldspace().fields,n=te.call(this,this.getPartialFieldspace().fields,this._rowDiffset,e.getAllFields?t.map(function(e){return e.name()}).join():this._colIdentifier,e.sort,{columnWise:"column"===e.order,addUid:!!e.withUid});if(!e.formatter)return n;var r=e.formatter,a=n.data,i=n.schema,o=n.uids,u=i.map(function(e){return e.name}),c=Object.keys(r).reduce(function(e,t){var n=u.indexOf(t);return-1!==n&&e.push([n,r[t]]),e},[]);return"column"===e.order?c.forEach(function(e){var t=e[0],n=e[1];a[t].forEach(function(e,r){a[t][r]=n.call(void 0,e,o[r],i[t])})}):a.forEach(function(e,t){c.forEach(function(n){var r=n[0],a=n[1];e[r]=a.call(void 0,e[r],o[t],i[r])})}),n}},{key:"getUids",value:function(){var e=this._rowDiffset,t=[];e.length&&e.split(",").forEach(function(e){var n=e.split("-").map(Number),r=zt(n,2),a=r[0],i=r[1];i=void 0!==i?i:a,t.push.apply(t,Wt(Array(i-a+1).fill().map(function(e,t){return a+t})))});return t}},{key:"groupBy",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{saveChild:!0},r=""+e.join(),a=[this,e,t],i=_e.apply(void 0,a);return At(this,i,U.GROUPBY,{fieldsArr:e,groupByString:r,defaultReducer:we.defaultReducer()},t),n.saveChild?i.setParent(this):i.setParent(null),i}},{key:"sort",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{saveChild:!1},n=this.getData({order:"row",sort:e}),r=[n.schema.map(function(e){return e.name})].concat(n.data),a=new this.constructor(r,n.schema,{dataFormat:"DSVArr"});return At(this,a,U.SORT,t,e),t.saveChild?a.setParent(this):a.setParent(null),a}},{key:"serialize",value:function(e,t){e=e||this._dataFormat,t=Object.assign({},{fieldSeparator:","},t);var n=this.getFieldspace().fields,r=n.map(function(e){return e.formattedData()}),a=r[0].length,i=void 0,u=void 0,c=void 0;if(e===o.FLAT_JSON)for(i=[],u=0;u<a;u++){var f={};for(c=0;c<n.length;c++)f[n[c].name()]=r[c][u];i.push(f)}else if(e===o.DSV_STR){for(i=[n.map(function(e){return e.name()}).join(t.fieldSeparator)],u=0;u<a;u++){var l=[];for(c=0;c<n.length;c++)l.push(r[c][u]);i.push(l.join(t.fieldSeparator))}i=i.join("\n")}else{if(e!==o.DSV_ARR)throw new Error("Data type "+e+" is not supported");for(i=[n.map(function(e){return e.name()})],u=0;u<a;u++){var s=[];for(c=0;c<n.length;c++)s.push(r[c][u]);i.push(s)}}return i}},{key:"addField",value:function(e){var t=e.name();this._colIdentifier+=","+t;var n=this._partialFieldspace,r=n._cachedValueObjects,a=e.formattedData(),i=e.partialField.data;if(n.fieldsObj()[e.name()]){var o=n.fields.findIndex(function(e){return e.name()===t});o>=0&&(n.fields[o]=e)}else n.fields.push(e),r.forEach(function(t,n){t[e.name()]=new N(a[n],i[n],e)});return n._cachedFieldsObj=null,n._cachedDimension=null,n._cachedMeasure=null,this.__calculateFieldspace().calculateFieldsConfig(),this}},{key:"calculateVariable",value:function(e,t,n){var r=this;e=Mt(e),n=Object.assign({},{saveChild:!0,replaceVar:!1},n);var a=this.getFieldsConfig(),i=t.slice(0,t.length-1),o=t[t.length-1];if(a[e.name]&&!n.replaceVar)throw new Error(e.name+" field already exists in datamodel");var u=i.map(function(e){var t=a[e];if(!t)throw new Error(e+" is not a valid column name.");return t.index}),c=this.clone(n.saveChild),f=c.getFieldspace().fields,l=u.map(function(e){return f[e]}),s={},d=function(){return r.detachedRoot()},p=[];T(c._rowDiffset,function(e){var t=l.map(function(t){return t.partialField.data[e]});p[e]=o.apply(void 0,Wt(t).concat([e,d,s]))});var h=Qe([p],[e],[e.name]),v=zt(h,1)[0];return c.addField(v),At(this,c,U.CAL_VAR,{config:e,fields:i},o),c}},{key:"propagate",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments[2],r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},a=t.isMutableAction,i=t.sourceId,o=t.payload,u=function(e){for(;e._parent;)e=e._parent;return e}(this),c=u._propagationNameSpace,f={groupByModel:function(e){for(;e._parent&&e._derivation.find(function(e){return e.op!==U.GROUPBY});)e=e._parent;return e}(this),model:u};return n&&function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments[2],r=void 0,a=t.isMutableAction,i=t.criteria,o=t.action+"-"+t.sourceId;r=a?e.mutableActions:e.immutableActions,null===i?delete r[o]:r[o]={model:n,config:t}}(c,t,this),Yt(e,f,{propagationNameSpace:c,sourceId:i},Object.assign({payload:o},t)),a&&function(e,t,n){var r=e.immutableActions;for(var a in r){var i=r[a].config,o=n.config.sourceId,u=!n.propConfig.filterImmutableAction||n.propConfig.filterImmutableAction(i,n.config);if(i.sourceId!==o&&u){var c=i.criteria;Yt(c,t,{propagationNameSpace:e,propagateToSource:!1,sourceId:o},i)}}}(c,f,{config:t,propConfig:r}),this}},{key:"on",value:function(e,t){switch(e){case"propagation":this._onPropagation.push(t)}return this}},{key:"unsubscribe",value:function(e){switch(e){case"propagation":this._onPropagation=[]}return this}},{key:"handlePropagation",value:function(e,t){var n=this;this._onPropagation.forEach(function(r){return r.call(n,e,t)})}},{key:"bin",value:function(e,t){var n=this.getFieldsConfig();if(!n[e])throw new Error("Field "+e+" doesn't exist");var r=t.name||e+"_binned";if(n[r])throw new Error("Field "+r+" already exists");var a=function(e,t,n){var r=n.buckets,a=n.binsCount,i=n.binSize,o=n.start,u=n.end,c=e.domain(),f=I(c,2),l=f[0],s=f[1];r||(o=0!==o&&(!o||o>l)?l:o,u=0!==u&&(!u||u<s)?s+1:u,a&&(i=Math.ceil(Math.abs(u-o)/a)),r=P(i,o,u)),r[0]>l&&r.unshift(l),r[r.length-1]<=s&&r.push(s+1);for(var d=[],p=0;p<r.length-1;p++)d.push({start:r[p],end:r[p+1]});var h=[];return T(t,function(t){var n=e.partialField.data[t];if(n instanceof M)h.push(n);else{var r=x(d,n);h.push(r.start+"-"+r.end)}}),{binnedData:h,bins:r}}(this.getFieldspace().fieldsObj()[e],this._rowDiffset,t),i=a.binnedData,o=a.bins,c=Qe([i],[{name:r,type:f.DIMENSION,subtype:u.BINNED,bins:o}],[r])[0],l=this.clone(t.saveChild);return l.addField(c),At(this,l,U.BIN,{measureFieldName:e,config:t,binFieldName:r},null),l}},{key:"detachedRoot",value:function(){return new t(this.serialize(o.FLAT_JSON),this.getSchema())}},{key:"splitByRow",value:function(e,t,n){var r=this.getFieldsConfig();e.forEach(function(e){if(!r[e])throw new Error("Field "+e+" doesn't exist in the schema")});var a={mode:l.NORMAL,saveChild:!0};return n=Object.assign({},a,n),Tt(this,e,t,n)}},{key:"splitByColumn",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],n=arguments[2],r={mode:l.NORMAL,saveChild:!0},a=this.getFieldsConfig(),i=Object.keys(a),o=[[t]];return n=Object.assign({},r,n),(e=e.length?e:[[]]).forEach(function(e,n){o[n]=Bt([].concat(Wt(e),Wt(t)),i,a)}),function(e,t,n,r){return t.map(function(t){return Ct(e,t,n,r)})}(this,o,n,i)}}],[{key:"configureInvalidAwareTypes",value:function(e){return M.invalidAwareVals(e)}},{key:"Reducers",get:function(){return we}}]),t}(),qt=me.sum,Zt=me.avg,$t=me.min,Qt=me.max,en=me.first,tn=me.last,nn=me.count,rn=me.std,an={compose:function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];return function(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{saveChild:!0},r=e,a=void 0,i=[];return t.forEach(function(e){r=e(r),i.push.apply(i,function(e){if(Array.isArray(e)){for(var t=0,n=Array(e.length);t<e.length;t++)n[t]=e[t];return n}return Array.from(e)}(r._derivation)),a||(a=r)}),a&&a!==r&&a.dispose(),r._ancestorDerivation=[],At(e,r,U.COMPOSE,null,i),n.saveChild?r.setParent(e):r.setParent(null),r}},bin:function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];return function(e){return e.bin.apply(e,t)}},select:function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];return function(e){return e.select.apply(e,t)}},project:function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];return function(e){return e.project.apply(e,t)}},groupBy:function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];return function(e){return e.groupBy.apply(e,t)}},calculateVariable:function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];return function(e){return e.calculateVariable.apply(e,t)}},sort:function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];return function(e){return e.sort.apply(e,t)}},crossProduct:H,difference:ne,naturalJoin:function(e,t){return H(e,t,Ee(e,t),!0)},leftOuterJoin:je,rightOuterJoin:Se,fullOuterJoin:function(e,t,n){return Ae(je(e,t,n),Se(e,t,n))},union:Ae},on=n(0).version;Object.assign(Xt,{Operators:an,Stats:i,DM_DERIVATIVES:U,DateTimeFormatter:h,DataFormat:o,FilteringMode:l,InvalidAwareTypes:M,version:on},r);var un=t.default=Xt}])});
//# sourceMappingURL=datamodel.js.map